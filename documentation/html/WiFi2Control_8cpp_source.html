<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MBC-WB Documentation: WiFi2Control.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MBC-WB Documentation
   &#160;<span id="projectnumber">1.3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('WiFi2Control_8cpp_source.html','');});
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">WiFi2Control.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="WiFi2Control_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  Meteca SA.  All right reserved.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">  created by Dario Trimarchi and Chiara Ruggeri 2017-2018</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">  email: support@meteca.org</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">  This library is free software; you can redistribute it and/or</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">  modify it under the terms of the GNU Lesser General Public</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  License as published by the Free Software Foundation; either</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">  version 2.1 of the License, or (at your option) any later version.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">  This library is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">  Lesser General Public License for more details.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">  You should have received a copy of the GNU Lesser General Public</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">  License along with this library; if not, write to the Free Software</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="WiFi2Control_8h.html">WiFi2Control.h</a>&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="CommCmd_8h.html">CommCmd.h</a>&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="communication_8h.html">communication.h</a>&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="events_8h.html">events.h</a>&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="WiFi2Control_8cpp.html#a53627a87689f6b28c893e4f83c15087d">   26</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="WiFi2Control_8cpp.html#a53627a87689f6b28c893e4f83c15087d">onEvent</a>(WiFiEvent_t event){</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">   *  event management system. Look at tools\sdk\include\esp32\esp_event.h</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">   *  for a complete list of events</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">   */</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">   #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  Serial.println(<span class="stringliteral">&quot;Received a new event: &quot;</span> + String(event));</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordflow">switch</span> (event){</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_DISCONNECTED:</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">      #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;      Serial.print(<span class="stringliteral">&quot;Station disconnected: &quot;</span>);</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">      #endif</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;      <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>.<a class="code" href="classWiFi2ControlClass.html#ad6cc679f93b3baa8a0c966e77cf62795">connectionStatus</a> = <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a41788794f8616c31855dc1c285682d74">WL_DISCONNECTED</a>;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>.<a class="code" href="classWiFi2ControlClass.html#a0b46c3910fb26ebfb8a205491ba639a0">notify</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>.<a class="code" href="classWiFi2ControlClass.html#aff215dbd9b5148412da2cc8e67f80579">connectionRequested</a>){ <span class="comment">// try to connect to a stored network if previous connection requested, by specifying ssid and pwd, failed</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>.<a class="code" href="classWiFi2ControlClass.html#aff215dbd9b5148412da2cc8e67f80579">connectionRequested</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>.<a class="code" href="classWiFi2ControlClass.html#a38c689d36084e4457d5c3ee1c8ba25c9">startAutoconnect</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      }</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#aebc52eadd9e58437b13f8d1167771b03">WiFi_disconnected</a>)</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;          <a class="code" href="events_8h.html#aebc52eadd9e58437b13f8d1167771b03">WiFi_disconnected</a>();</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      </div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_CONNECTED:</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">      #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        Serial.print(<span class="stringliteral">&quot;Station connected: &quot;</span>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">      #endif</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>.<a class="code" href="classWiFi2ControlClass.html#ad6cc679f93b3baa8a0c966e77cf62795">connectionStatus</a> = <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a321b58e6917f8ba6733b1e9ebef51e9b">WL_CONNECTED</a>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>.<a class="code" href="classWiFi2ControlClass.html#a0b46c3910fb26ebfb8a205491ba639a0">notify</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>.<a class="code" href="classWiFi2ControlClass.html#aff215dbd9b5148412da2cc8e67f80579">connectionRequested</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      </div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a0fd5c6953941943272e08c32f3cc9a2b">WiFi_connected</a>)</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;          <a class="code" href="events_8h.html#a0fd5c6953941943272e08c32f3cc9a2b">WiFi_connected</a>();</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_WIFI_READY:</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#ada707cf4ce2efd1f1609ca9dbab3b19f">WiFi_ready</a>)</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <a class="code" href="events_8h.html#ada707cf4ce2efd1f1609ca9dbab3b19f">WiFi_ready</a>();</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    </div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_SCAN_DONE:</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a0b4b9d9ea9797b24f475eb0dc1829eb4">WiFi_scanDone</a>)</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <a class="code" href="events_8h.html#a0b4b9d9ea9797b24f475eb0dc1829eb4">WiFi_scanDone</a>();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_START:</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a91f7e095a6de63c8d8243659333dd51c">WiFi_startedSTA</a>)</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <a class="code" href="events_8h.html#a91f7e095a6de63c8d8243659333dd51c">WiFi_startedSTA</a>();</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    </div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_STOP:</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a90585c4c60570404bc3323700ab03143">WiFi_stoppedSTA</a>)</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <a class="code" href="events_8h.html#a90585c4c60570404bc3323700ab03143">WiFi_stoppedSTA</a>();</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    </div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_AUTHMODE_CHANGE:</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a95cfe4829716876554a40d54d01df6b9">WiFi_authModeChanged</a>)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <a class="code" href="events_8h.html#a95cfe4829716876554a40d54d01df6b9">WiFi_authModeChanged</a>();</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    </div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_GOT_IP:</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a269ab8c264464ed08cfbdf747294992c">WiFi_gotIP</a>)</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <a class="code" href="events_8h.html#a269ab8c264464ed08cfbdf747294992c">WiFi_gotIP</a>();</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    </div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_LOST_IP:</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a45e7f3e16c714b5d1b24c567c4c101d0">WiFi_lostIP</a>)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <a class="code" href="events_8h.html#a45e7f3e16c714b5d1b24c567c4c101d0">WiFi_lostIP</a>();</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    </div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_WPS_ER_SUCCESS:</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a66bcf2d8895a07a4ac6afd67b130744f">WiFi_wpsEnrolleeSuccess</a>)</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <a class="code" href="events_8h.html#a66bcf2d8895a07a4ac6afd67b130744f">WiFi_wpsEnrolleeSuccess</a>();</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    </div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_WPS_ER_FAILED:</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#ac1ca3f75344a3bafb5b284cf897fdee2">WiFi_wpsEnrolleeFailed</a>)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <a class="code" href="events_8h.html#ac1ca3f75344a3bafb5b284cf897fdee2">WiFi_wpsEnrolleeFailed</a>();</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    </div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_WPS_ER_TIMEOUT:</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a67c1cacbe4dd1e3759784ce8db9c2fae">WiFi_wpsEnrolleeTimeout</a>)</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            <a class="code" href="events_8h.html#a67c1cacbe4dd1e3759784ce8db9c2fae">WiFi_wpsEnrolleeTimeout</a>();</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    </div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_STA_WPS_ER_PIN:</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a8480c3a3426d23fac4e372a4c52d21a5">WiFi_wpsEnrolleePinCode</a>)</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <a class="code" href="events_8h.html#a8480c3a3426d23fac4e372a4c52d21a5">WiFi_wpsEnrolleePinCode</a>();</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    </div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_AP_START:</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a7fa4ede1f42d0fd1407e4c7a2428ac05">WiFi_startedAP</a>)</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <a class="code" href="events_8h.html#a7fa4ede1f42d0fd1407e4c7a2428ac05">WiFi_startedAP</a>();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    </div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_AP_STOP:</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a239236b07de039a3c606310db6d539ee">WiFi_stoppedAP</a>)</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <a class="code" href="events_8h.html#a239236b07de039a3c606310db6d539ee">WiFi_stoppedAP</a>();</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    </div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_AP_STACONNECTED:</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a9c09a4e455e72a2dec2a832c957a01bc">WiFi_STAconnectedToAP</a>)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <a class="code" href="events_8h.html#a9c09a4e455e72a2dec2a832c957a01bc">WiFi_STAconnectedToAP</a>();</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_AP_STADISCONNECTED:</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a6f0583ea1b845a7b3c9708e05beb2bac">WiFi_STAdisconnectedFromAP</a>)</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <a class="code" href="events_8h.html#a6f0583ea1b845a7b3c9708e05beb2bac">WiFi_STAdisconnectedFromAP</a>();</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    </div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_AP_STAIPASSIGNED:</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a3be200855f4e561f9d14809793cfdd84">WiFi_APassignedIP2STA</a>)</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <a class="code" href="events_8h.html#a3be200855f4e561f9d14809793cfdd84">WiFi_APassignedIP2STA</a>();</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    </div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_AP_PROBEREQRECVED:</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a88a76466fcafd878d030c6b96f7229c4">WiFi_APreceivedProbe</a>)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <a class="code" href="events_8h.html#a88a76466fcafd878d030c6b96f7229c4">WiFi_APreceivedProbe</a>();</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    </div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">case</span> SYSTEM_EVENT_GOT_IP6:</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="events_8h.html#a3ace50bb44c40721572beae929fae20c">WiFi_gotIPv6</a>)</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <a class="code" href="events_8h.html#a3ace50bb44c40721572beae929fae20c">WiFi_gotIPv6</a>();</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;}</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="WiFi2Control_8cpp.html#ae931bf97db55e968fca362499cd00f4f">  156</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="WiFi2Control_8cpp.html#ae931bf97db55e968fca362499cd00f4f">process</a>(<span class="keywordtype">void</span>){</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="keywordtype">bool</span> rep = <span class="keyword">true</span>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  </div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  memcpy((uint8_t*)&amp;<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._tempPkt, <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#ab8fd407bc6d18b933335366b6e0b8912">getRxBuffer</a>(), <span class="keyword">sizeof</span>(<a class="code" href="wifi__drv_8h.html#ae49487ef4d75cc4b24d6eb80266f8676">tsNewCmd</a>));</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  </div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; <span class="keywordflow">if</span>(<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._tempPkt.cmd &lt; 0x30)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    rep = <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._processWiFiCmd(<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._tempPkt.cmd);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._tempPkt.cmd &lt; 0x32)</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    rep = <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._processServerCmd(<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._tempPkt.cmd);</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._tempPkt.cmd &lt; 0x40)</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    rep = <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._processClientCmd(<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._tempPkt.cmd);</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._tempPkt.cmd &lt; 0x50)</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    rep = <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._processDataCmd(<a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>._tempPkt.cmd);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  </div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">return</span> rep;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;}</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">// ----------------------------------------------- WiFi2ControlClass -----------------------------------------------</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">// ----------------------------------------------------- PUBLIC</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="classWiFi2ControlClass.html#a4334306b0831c95d5374d33b9b8ea190">  180</a></span>&#160;<a class="code" href="classWiFi2ControlClass.html#a4334306b0831c95d5374d33b9b8ea190">WiFi2ControlClass::WiFi2ControlClass</a>()</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;{</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;}</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="classWiFi2ControlClass.html#a174bb9824460cbe63fb27ddd4e63971b">  188</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classWiFi2ControlClass.html#a174bb9824460cbe63fb27ddd4e63971b">WiFi2ControlClass::begin</a>()</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;{</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  EEPROM.begin(1024);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    </div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="comment">// register process function in order to be able to receive commands from control chip</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a53722ef58d275f2870e956526ceae8fe">registerHandle</a>(<a class="code" href="classWiFi2ControlClass.html#ae931bf97db55e968fca362499cd00f4f">process</a>);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="comment">//_clearWiFiSSIDList();</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="comment">// fetch WiFi network list from flash memory</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  _fetchWiFiSSIDList();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">  #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">    for(uint8_t i=0; i&lt;MAX_NETWORK_LIST; i++){</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">      Serial.print(&quot;\nSSID: &quot;);</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">      Serial.write(networkArray.netEntry[i].strSSID, 32);</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">      Serial.print(&quot;\nPWD: &quot;);</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">      Serial.write(networkArray.netEntry[i].strPWD, 64);</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">      Serial.print(&quot;\naging: &quot;);</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">      Serial.println(networkArray.netEntry[i].aging);</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">  #endif</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> = 0;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;  _nets.<a class="code" href="structtsNetworkParams.html#a300d6c3ed27b0f75cb5df805829af5d2">currNetIdx</a> = 0;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="comment">//WiFiEvent_t event</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.onEvent(<a class="code" href="WiFi2Control_8cpp.html#a53627a87689f6b28c893e4f83c15087d">onEvent</a>);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#af199a17c86b974212683cc0ec46c8875">begin</a>();</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <a class="code" href="classWiFi2ControlClass.html#a1ce1e440c6411dc6c474a1c51f1534fc">setWiFiConfig</a>(WIFI_AP_STA);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  </div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <span class="comment">// wait initialization phase</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <span class="keywordflow">while</span>(!<a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.companionReady());</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="classWiFi2ControlClass.html#a3e1f8c8755a9876be81c5f260ed565d5">  225</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classWiFi2ControlClass.html#a3e1f8c8755a9876be81c5f260ed565d5">WiFi2ControlClass::poll</a>()</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;{</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    _pollCommands();</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    _pollFromWiFi();</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="classWiFi2ControlClass.html#a1ce1e440c6411dc6c474a1c51f1534fc">  234</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classWiFi2ControlClass.html#a1ce1e440c6411dc6c474a1c51f1534fc">WiFi2ControlClass::setWiFiConfig</a>(WiFiMode_t mode)</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;{</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  <a class="code" href="classWiFi2ControlClass.html#a1ce1e440c6411dc6c474a1c51f1534fc">setWiFiConfig</a>(mode, NULL, NULL);</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="classWiFi2ControlClass.html#a805d4285f5b35d6ff664ae483f1bd893">  239</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classWiFi2ControlClass.html#a1ce1e440c6411dc6c474a1c51f1534fc">WiFi2ControlClass::setWiFiConfig</a>(WiFiMode_t mode, <span class="keyword">const</span> <span class="keywordtype">char</span> *apName)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;{</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <a class="code" href="classWiFi2ControlClass.html#a1ce1e440c6411dc6c474a1c51f1534fc">setWiFiConfig</a>(mode, apName, NULL);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="classWiFi2ControlClass.html#ab97b855c7e3c26e3c52319db8c0ecfe1">  244</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classWiFi2ControlClass.html#a1ce1e440c6411dc6c474a1c51f1534fc">WiFi2ControlClass::setWiFiConfig</a>(WiFiMode_t mode, <span class="keyword">const</span> <span class="keywordtype">char</span> *apName, <span class="keyword">const</span> <span class="keywordtype">char</span> *apPwd)</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;{</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  <span class="keywordtype">char</span> softApssid[33];</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  </div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  <span class="comment">//set mode</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.mode(mode);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a4fb9b420236be7d67dfb2a72ec47d308">disconnect</a>();</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  delay(100);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  <span class="comment">//set default AP</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">if</span>(mode == WIFI_AP || mode == WIFI_AP_STA){</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.softAPConfig(default_IP, default_IP, IPAddress(255, 255, 255, 0));   <span class="comment">//set default ip for AP mode</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    </div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span>(apName == NULL){</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      String mac = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#ab5488e05c1389430b3f1a6aee091fcac">macAddress</a>();</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      String apSSID = String(SSIDNAME) + <span class="stringliteral">&quot;-&quot;</span> + String(mac[9])+String(mac[10])+String(mac[12])+String(mac[13])+String(mac[15])+String(mac[16]);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      apSSID.toCharArray(softApssid, apSSID.length()+1);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.softAP(softApssid);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordflow">if</span>(apPwd != NULL){</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.softAP(apName, apPwd);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.softAP(apName);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_notifyReady()</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  uint8_t response = 1;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba1a471fdd11a8546f36d55b7e0a022921">COMPANION_READY</a>, PARAM_NUMS_1);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;response, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;}</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="classWiFi2ControlClass.html#ab581678b0591fa87238d7ad72e2e186b">  283</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classWiFi2ControlClass.html#ab581678b0591fa87238d7ad72e2e186b">WiFi2ControlClass::autoconnect</a>()</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;{</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  uint8_t result;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="keywordtype">char</span> ssidNet[33] = {0};</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  int32_t rssi = -100;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  int32_t tempRssi = 0;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  uint32_t start = 0;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  start = millis() + <a class="code" href="WiFi2Control_8h.html#a0c63390af22aa0f877eece67372a7414">CONNECTION_TIMEOUT</a>;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> = -1;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="comment">//scanNetworks command</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#aceb4deceab051045bd1000b6ca295fe3">scanNetworks</a>(<span class="keyword">false</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    delayMicroseconds(100);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  } <span class="keywordflow">while</span> (_nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> &lt; 0 &amp;&amp; start &gt; millis());</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordflow">if</span> (_nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> &lt;= 0){</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> = 0;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    result = <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42ae41f591ecb2a3c7f0b22194cde6fac8c">WL_NO_SSID_AVAIL</a>;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="preprocessor">    #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      Serial.println(<span class="stringliteral">&quot;no network found&quot;</span>);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">for</span>(uint8_t i=0; i&lt;_nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a>; i++) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      strcpy(ssidNet, <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a0d4b45ce1ad3338b51c1e2bed438ab79">SSID</a>(i).c_str());</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">for</span>(uint8_t j=0; j&lt;<a class="code" href="WiFi2Control_8h.html#a1ca079faac5937dd224e346d841ccb81">MAX_NETWORK_LIST</a>; j++){</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">if</span>(strcmp((<span class="keywordtype">char</span>*)ssidNet, <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[j].strSSID) == 0) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;          found = <span class="keyword">true</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;          <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected == j){  <span class="comment">//last connected -&gt; connect directly</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a> = j;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="preprocessor">            #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;              Serial.println(<span class="stringliteral">&quot;Connect to the last connected&quot;</span>);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="preprocessor">            #endif</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;          }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;          tempRssi = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a1af6ef55e20b1f1c3a7913049a0b54ab">RSSI</a>(i);</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;          <span class="keywordflow">if</span>(rssi &lt; tempRssi) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            rssi = tempRssi;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a> = j;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;          }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <span class="keywordflow">if</span>(found)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      memset(ssidNet, 0, 33);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  }</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">// a network match found</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a> &gt;= 0) {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="preprocessor">    #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      Serial.print(<span class="stringliteral">&quot;\nSSID: &quot;</span>);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      Serial.println((<span class="keywordtype">char</span> *)<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>].strSSID);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      Serial.print(<span class="stringliteral">&quot;PWD: &quot;</span>);</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      Serial.println((<span class="keywordtype">char</span> *)<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>].strPWD);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    </div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a20e71a9130244ededffc081c9891fb07">status</a>() == <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a321b58e6917f8ba6733b1e9ebef51e9b">WL_CONNECTED</a>){</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="comment">//if(networkArray.netEntry[connectedIndex_temp].strSSID != Config.getParam(&quot;ssid&quot;).c_str() != ssidNet)</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a4fb9b420236be7d67dfb2a72ec47d308">disconnect</a>();</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    }</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="classWiFi2ControlClass.html#a57360801d1b6db9b2e2d8c91fd5a74e6">connectionTimeout</a> = millis() + <a class="code" href="WiFi2Control_8h.html#a0c63390af22aa0f877eece67372a7414">CONNECTION_TIMEOUT</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="classWiFi2ControlClass.html#ad6cc679f93b3baa8a0c966e77cf62795">connectionStatus</a> = <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a23eb406d022f014ca5cc982dc3d3d681">WL_IDLE_STATUS</a>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#af199a17c86b974212683cc0ec46c8875">begin</a>(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>].strSSID, <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>].strPWD);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">else</span>{</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">    #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;      Serial.println(<span class="stringliteral">&quot;No network memorized or match found&quot;</span>);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="keywordflow">return</span> found;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;}</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">// ----------------------------------------------------- PRIVATE</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_pollCommands(){</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#ab0e54265d77a4368b54c8adff6966cff">handleCommEvents</a>();</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;}</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_pollFromWiFi(){</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="comment">// poll for events from high-level interface</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code" href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a>; i++){</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">// check for server events</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> (!_sockInUse[i].inUse) { <span class="comment">// wait for other requests on the same socket to be completed before accepting new ones</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordflow">if</span> (_mapWiFiServers[i] != NULL) {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        _mapWiFiClients[i] = _mapWiFiServers[i]-&gt;<a class="code" href="classWiFiServer.html#abfd839b75fa3c40bd5e22c4a122ed800">available</a>();</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        uint8_t result = _mapWiFiClients[i].<a class="code" href="classWiFiClient.html#aaf69c75c27d44c01484185e9306bd8da">connected</a>();</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <span class="keywordflow">if</span> (result &gt; 0) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="preprocessor">          #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="comment">//Serial.println(&quot;client connected to my server&quot;);</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="preprocessor">          #endif</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;          _sendEventPacket(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba8b3e8191eaf4fc5d2206a676224cb38e">GET_CLIENT_STATE_TCP</a>, i, &amp;result);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;          _sockInUse[i].<a class="code" href="structtsSockStatus.html#a7e375aca04796b0e1dd152f3fa00e0cd">inUse</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;          _sockInUse[i].<a class="code" href="structtsSockStatus.html#aaabca1f6fb1e74552fd62311a0349bb2">conn</a> = <span class="keyword">true</span>; </div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;          _sockInUse[i].<a class="code" href="structtsSockStatus.html#ae3aa4acc04c59c0bea282b682be9ab8d">protocol</a> = <a class="code" href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a>;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;          _oldDataClient[i] = 0;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">// check for client events</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordflow">if</span>(_sockInUse[i].conn == <span class="keyword">true</span> &amp;&amp; _sockInUse[i].protocol == <a class="code" href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a>) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="keywordtype">bool</span> disconnected = <span class="keyword">false</span>;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keywordflow">if</span>(uint16_t result = _mapWiFiClients[i].available()){</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="comment">// check if there are available data only if oldDataClint for that socket is less than the data available on the clinet, otherwise consider that the other micro is aware about the number of data available</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="keywordflow">if</span> (_oldDataClient[i] &lt; result) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="preprocessor">          #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="comment">//Serial.println(&quot;new data&quot;);</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="preprocessor">          #endif</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;          uint8_t pkt[] = {((uint8_t *)&amp;result)[0], ((uint8_t *)&amp;result)[1]};</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          _sendEventPacket(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bac299c95ea1c165b31b18784254ebb6e7">AVAIL_DATA_TCP</a>, i, pkt, 2);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;          _oldDataClient[i] = result;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      }</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!_mapWiFiClients[i].connected())</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;          disconnected = <span class="keyword">true</span>;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordflow">if</span>(disconnected){  <span class="comment">// remote client was disconnected. close socket and send related event</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="preprocessor">        #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          <span class="comment">//Serial.println(&quot;socket closed&quot;);</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="preprocessor">        #endif</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        uint8_t status = 0;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        </div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        _sendEventPacket(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba8b3e8191eaf4fc5d2206a676224cb38e">GET_CLIENT_STATE_TCP</a>, i, &amp;status);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        _sockInUse[i].<a class="code" href="structtsSockStatus.html#aaabca1f6fb1e74552fd62311a0349bb2">conn</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        _sockInUse[i].<a class="code" href="structtsSockStatus.html#a7e375aca04796b0e1dd152f3fa00e0cd">inUse</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        _mapWiFiClients[i].<a class="code" href="classWiFiClient.html#a43c3ec6dfd681de3eacb1b0ec835991f">stop</a>();</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      }</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    </div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">if</span>(_sockInUse[i].protocol == <a class="code" href="WiFi2Control_8h.html#afb5ebfaff9a32a76648ad89c0ab05a11">PROT_UDP</a>){</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        uint16_t result = _mapWiFiUDP[i].<a class="code" href="classWiFiUDP.html#acdff2434208d9cb0c32ef9f2a803764a">parsePacket</a>();</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">if</span> (result &gt; 0){ </div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;          <span class="comment">// notify presence of data</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;          uint8_t pkt[] = {((uint8_t *)&amp;result)[0], ((uint8_t *)&amp;result)[1]};</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;          _sendEventPacket(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bac299c95ea1c165b31b18784254ebb6e7">AVAIL_DATA_TCP</a>, i, pkt, 2);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="preprocessor">          #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            Serial.println(<span class="stringliteral">&quot;sending udp event&quot;</span> + String(result));</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="preprocessor">          #endif</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        }</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      }</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    }</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  </div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classWiFi2ControlClass.html#a57360801d1b6db9b2e2d8c91fd5a74e6">connectionTimeout</a> != 0 &amp;&amp; <a class="code" href="classWiFi2ControlClass.html#a57360801d1b6db9b2e2d8c91fd5a74e6">connectionTimeout</a> &lt; millis() &amp;&amp; <a class="code" href="classWiFi2ControlClass.html#ad6cc679f93b3baa8a0c966e77cf62795">connectionStatus</a> != <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a321b58e6917f8ba6733b1e9ebef51e9b">WL_CONNECTED</a>){</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <a class="code" href="classWiFi2ControlClass.html#a57360801d1b6db9b2e2d8c91fd5a74e6">connectionTimeout</a> = 0;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a4fb9b420236be7d67dfb2a72ec47d308">disconnect</a>();</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="preprocessor">    #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      Serial.println(<span class="stringliteral">&quot;Connection timeout&quot;</span>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#a38c689d36084e4457d5c3ee1c8ba25c9">startAutoconnect</a>){</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="classWiFi2ControlClass.html#a38c689d36084e4457d5c3ee1c8ba25c9">startAutoconnect</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="classWiFi2ControlClass.html#ab581678b0591fa87238d7ad72e2e186b">autoconnect</a>();</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  }</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classWiFi2ControlClass.html#a0b46c3910fb26ebfb8a205491ba639a0">notify</a>) {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="classWiFi2ControlClass.html#a0b46c3910fb26ebfb8a205491ba639a0">notify</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    <span class="comment">// send the asynchronous event</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    _notifySTAConnStatus(<a class="code" href="classWiFi2ControlClass.html#ad6cc679f93b3baa8a0c966e77cf62795">connectionStatus</a>);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;}</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordtype">bool</span> WiFi2ControlClass::_processWiFiCmd(uint8_t cmd){</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordtype">bool</span> rep = <span class="keyword">true</span>;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    </div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="keywordflow">switch</span> (cmd){</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba5539e53ed61fde62295ba4af1b845243">GET_CONN_STATUS</a>:</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      _getStatus();</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba70802fb550abcdde74b43342bae89dea">GET_FW_VERSION</a>:</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      _getFwVersion();</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2e4494a749e2575ef2cc9dd242ed2831">CONNECT_OPEN_AP</a>:</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      rep = _connect(0);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baad80dbc7e38debd3ae2b5b88603012f5">CONNECT_SECURED_AP</a>:</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      rep = _connect(1);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa0621f916125879e94f0932344d8b727">AUTOCONNECT_TO_STA</a>:</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      rep = _connect(2);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2f6318afb30e8e2817e6203ebedc8173">DISCONNECT</a>:</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      rep = _disconnect();</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba3261512e88bf62679d958fb8f2d7b508">CANCEL_NETWORK_LIST</a>:</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      _clearWiFiSSIDList();</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba52f7f1cecc99100c18be5b3b1c799728">SET_IP_CONFIG</a>:</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      _config();</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2c59a3c99c4a672a33aa6b50edebc69c">SET_DNS_CONFIG</a>:</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      _setDNS();</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba6f2b4b1e20dd0b745f876a8fe4df0108">GET_HOSTNAME</a>:</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;      _getHostname();</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba5aa962708eba267c096b88303b0a32c2">GET_IPADDR</a>:</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      _getNetworkData();</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba94e1b147729a78f4e0539f80c0a33eb3">GET_MACADDR</a>:</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      _getMacAddress();</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bae3e0d811eb51e0e254a986391673ba81">GET_CURR_SSID</a>:</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      _getCurrentSSID();</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba399a55699ba7c64aa885b68c43d8675e">GET_CURR_BSSID</a>:</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      _getBSSID();</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bac3e8ad93e3a6f831cb31ce15b8e18a7c">GET_CURR_RSSI</a>:</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      _getRSSI(1);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba59f98cc3438e29f13e7d46d89ff9d9e0">GET_IDX_RSSI</a>:</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      _getRSSI(0);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55badff0dd320f35248bacab96a25a5ac456">GET_CURR_ENCT</a>:</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      _getEncryption(1);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba259cff66ee612688d00b905734fe8718">GET_IDX_ENCT</a>:</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      _getEncryption(0);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba4791d7bdc9285d0b1bc90f1d8987228c">START_SCAN_NETWORKS</a>:</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      _startScanNetwork();</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">case</span> SCAN_NETWORK_RESULT:</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      _scanNetwork(_tempPkt.dataPtr[1]);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba74f43c68ee50636995e146bb5e0f0c33">GET_HOST_BY_NAME</a>:</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      _getHostByName();</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  </div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordflow">return</span> rep;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    </div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="keywordtype">bool</span> WiFi2ControlClass::_processServerCmd(uint8_t cmd){</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  uint8_t rep = <span class="keyword">true</span>;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  </div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">switch</span> (cmd){</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baeb2dc8b12016526b98289d01d742186c">START_SERVER_TCP</a>:</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      _startServer();</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  }</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  </div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordflow">return</span> rep;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;}</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="keywordtype">bool</span> WiFi2ControlClass::_processClientCmd(uint8_t cmd){</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  uint8_t rep = <span class="keyword">true</span>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      </div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  <span class="keywordflow">switch</span> (cmd){</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bafdb0b5226be87f454e7063ad56afe92c">GET_DATA_TCP</a>:</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      _getData();</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa15f5a3da49f2db90e2961fe95e84b82">STOP_CLIENT_TCP</a>:</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      _stopClient();</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba8b3e8191eaf4fc5d2206a676224cb38e">GET_CLIENT_STATE_TCP</a>:</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      _clientStatus();</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bad10173b7f1f5ee3ac8df3d3d6f68ef9f">SEND_DATA_TCP</a>:</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      rep = _sendData();</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba7705fb59ebe74fbbb033c16a7e20aade">START_CLIENT_TCP</a>:</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      _startClient();</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bacc50362f1baf46b75ffc0f96153dc8a6">SEND_DATA_UDP</a>:</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      _sendUdpData();</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bad322ee6f782ce9d1b2ec7e19cbf2e082">GET_REMOTE_DATA</a>:</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      _remoteData();</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  }</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  </div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;  <span class="keywordflow">return</span> rep;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;}</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="keywordtype">bool</span> WiFi2ControlClass::_processDataCmd(uint8_t cmd){</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="keywordtype">bool</span> rep = <span class="keyword">true</span>;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  </div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">switch</span> (cmd){</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba9e82537489a18598044889b033f19191">GET_DATABUF_TCP</a>: </div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      _getDataBuf();</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  </div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keywordflow">return</span> rep;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;}</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_notifySTAConnStatus(uint8_t stat)</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;{ </div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="keywordflow">if</span>(stat == <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a321b58e6917f8ba6733b1e9ebef51e9b">WL_CONNECTED</a>){</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a> &lt; 0){</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      int8_t ind = -1;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      </div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">// the network was already in the list</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">if</span>((ind = _checkSSIDInList(<a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strSSID)) &lt; 0){</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="comment">// SSID not present make a new entry</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected = _networkListEvalAging(0xff);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        memset(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected].strSSID, 0, 33);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        memset(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected].strPWD, 0, 65);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        strcpy(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected].strSSID, <a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strSSID);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2e4494a749e2575ef2cc9dd242ed2831">CONNECT_OPEN_AP</a>, PARAM_NUMS_1);</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strPWD[0] != 0xff){</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;          <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baad80dbc7e38debd3ae2b5b88603012f5">CONNECT_SECURED_AP</a>, PARAM_NUMS_1);   </div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;          strcpy(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected].strPWD, <a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strPWD);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment">// update the aging</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        _networkListEvalAging(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        delay(0);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        _storeWiFiSSIDList();</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        </div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      }</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <span class="keywordflow">else</span>{</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected = ind;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected].strPWD[0] != 0xff)</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;          <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baad80dbc7e38debd3ae2b5b88603012f5">CONNECT_SECURED_AP</a>, PARAM_NUMS_1);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="keywordflow">else</span> </div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;          <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2e4494a749e2575ef2cc9dd242ed2831">CONNECT_OPEN_AP</a>, PARAM_NUMS_1);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        _networkListEvalAging(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected);</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      }</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    }</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected = <a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected].strPWD[0] != 0xff)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baad80dbc7e38debd3ae2b5b88603012f5">CONNECT_SECURED_AP</a>, PARAM_NUMS_1);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">else</span> </div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2e4494a749e2575ef2cc9dd242ed2831">CONNECT_OPEN_AP</a>, PARAM_NUMS_1);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      _networkListEvalAging(<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      </div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">    #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">      for(uint8_t i=0; i&lt;MAX_NETWORK_LIST; i++){</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">        Serial.print(&quot;\nSSID: &quot;);</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">        Serial.write(networkArray.netEntry[i].strSSID, 32);</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">        Serial.print(&quot;\nPWD: &quot;);</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">        Serial.write(networkArray.netEntry[i].strPWD, 64);</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">        Serial.print(&quot;\naging: &quot;);</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">        Serial.println(networkArray.netEntry[i].aging);</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">        </span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">        delay(0);</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">      }</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">    #endif</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  }</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(stat == <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a41788794f8616c31855dc1c285682d74">WL_DISCONNECTED</a>){</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(<a class="code" href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2f6318afb30e8e2817e6203ebedc8173">DISCONNECT</a>, PARAM_NUMS_1);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="preprocessor">    #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      Serial.println(<span class="stringliteral">&quot;disconnecting...&quot;</span>);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;  }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a> = -1;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>((uint8_t*)&amp;stat, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;  <span class="comment">// manually enable reception after each asynchronous event</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.enableRx();</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;}</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getHostname()</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;{</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  String host = String(<a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#af5b13619e82e5c193c7c51205319e37b">getHostname</a>());</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  uint8_t sz = host.length();</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;   </div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="comment">// set the response struct</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>((uint8_t*)host.c_str(), sz, LAST_PARAM);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;}</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getStatus()</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;{</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="comment">// Disconnet from the network</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  uint8_t result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a20e71a9130244ededffc081c9891fb07">status</a>();</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="comment">// set the response struct</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>((uint8_t*)&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;}</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getFwVersion()</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;{</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="comment">// set the response struct</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>((uint8_t*)FW_VERSION, PARAM_SIZE_5, LAST_PARAM);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;}</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getMacAddress()</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;{</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  uint8_t mac[PARAM_SIZE_6];</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="comment">//Retrive mac address</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#ab5488e05c1389430b3f1a6aee091fcac">macAddress</a>(mac);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="comment">// set the response struct</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>((uint8_t*)mac, PARAM_SIZE_6, LAST_PARAM);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;}</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getCurrentSSID()</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;{</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  <span class="comment">//retrieve SSID of the current network</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  String result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a0d4b45ce1ad3338b51c1e2bed438ab79">SSID</a>();</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="comment">// set the response struct</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>((uint8_t*)result.c_str(), result.length(), LAST_PARAM);</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;}</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getRSSI(uint8_t current)</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;{</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  int32_t result;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  <span class="comment">//retrieve RSSI</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  <span class="keywordflow">if</span> (current == 1)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  {</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a1af6ef55e20b1f1c3a7913049a0b54ab">RSSI</a>();</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  }</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    int8_t net_idx = _tempPkt.dataPtr[1];</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="comment">// NOTE: only for test this function</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="comment">// user must call scan network before</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="comment">// int num = WiFi.scanNetworks();</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a1af6ef55e20b1f1c3a7913049a0b54ab">RSSI</a>(net_idx);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="comment">// set the response struct</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  uint8_t res[4] = {(int8_t)result, 0xFF, 0xFF, 0xFF};</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(res, PARAM_SIZE_4, LAST_PARAM);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;}</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getEncryption(uint8_t current)</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;{</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordflow">if</span> (current == 1)</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    String currSSID = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a0d4b45ce1ad3338b51c1e2bed438ab79">SSID</a>(); <span class="comment">//get current SSID</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a>; i++)</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      <span class="keywordflow">if</span> (currSSID == <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a0d4b45ce1ad3338b51c1e2bed438ab79">SSID</a>(i))</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        _nets.<a class="code" href="structtsNetworkParams.html#a300d6c3ed27b0f75cb5df805829af5d2">currNetIdx</a> = i; <span class="comment">//get the index of the current network</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      }</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  }</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    _nets.<a class="code" href="structtsNetworkParams.html#a300d6c3ed27b0f75cb5df805829af5d2">currNetIdx</a> = _tempPkt.dataPtr[1];</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  }</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  uint8_t result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a893073f5a619a72d9ff54778fc26d489">encryptionType</a>(_nets.<a class="code" href="structtsNetworkParams.html#a300d6c3ed27b0f75cb5df805829af5d2">currNetIdx</a>);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="comment">// set the response struct</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;}</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;uint8_t WiFi2ControlClass::_networkListEvalAging(uint8_t connectedIndex)</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;{</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  uint8_t agingVal = 0;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  uint8_t agingValStore = 0;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  uint8_t oldest = 0;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  <span class="comment">// request an index to store a new network</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordflow">if</span>(connectedIndex == 0xff){</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">for</span>(uint8_t i=0; i&lt;<a class="code" href="WiFi2Control_8h.html#a1ca079faac5937dd224e346d841ccb81">MAX_NETWORK_LIST</a>; i++){</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[i].aging == 0){</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[i].aging = 1;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="keywordflow">return</span> i;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      }</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      <span class="comment">// find out the oldest netowrk</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      <span class="keywordflow">if</span>(agingVal &lt; <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[i].aging){</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        agingVal = <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[i].aging;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        oldest = i;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    }</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  }</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordflow">else</span>{</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    agingValStore = <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[connectedIndex].aging;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[connectedIndex].aging = 1;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    </div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">for</span>(uint8_t i=0; i&lt;<a class="code" href="WiFi2Control_8h.html#a1ca079faac5937dd224e346d841ccb81">MAX_NETWORK_LIST</a>; i++){</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordflow">if</span>(connectedIndex == i)</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[i].aging != 0 &amp;&amp; <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[i].aging &lt; agingValStore){</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[i].aging++;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    }</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  }</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  </div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordflow">return</span> oldest;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;}</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;int8_t WiFi2ControlClass::_checkSSIDInList(<span class="keywordtype">char</span>* targetSSID)</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;{</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  int8_t index = -1;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="keywordflow">for</span>(uint8_t j=0; j&lt;<a class="code" href="WiFi2Control_8h.html#a1ca079faac5937dd224e346d841ccb81">MAX_NETWORK_LIST</a>; j++){</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">if</span>(strcmp(targetSSID, <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[j].strSSID) == 0) {</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      index = j;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;    }</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  }</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="keywordflow">return</span> index;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;}</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="keywordtype">bool</span> WiFi2ControlClass::_connect(uint8_t option)</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;{</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  uint8_t result;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  uint32_t start = 0;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a> = -1;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="comment">// autoconnect mode</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordflow">if</span>(option == 2) {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="preprocessor">    #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      Serial.println(<span class="stringliteral">&quot;Autoconnect mode&quot;</span>);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="preprocessor">    #endif</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordtype">char</span> ssidNet[33] = {0};</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    int32_t rssi = -100;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    int32_t tempRssi = 0;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    start = millis() + <a class="code" href="WiFi2Control_8h.html#a0c63390af22aa0f877eece67372a7414">CONNECTION_TIMEOUT</a>;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> = -1;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="comment">//scanNetworks command</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    <span class="keywordflow">do</span> {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#aceb4deceab051045bd1000b6ca295fe3">scanNetworks</a>(<span class="keyword">false</span>, <span class="keyword">false</span>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      delayMicroseconds(100);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    } <span class="keywordflow">while</span> (_nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> &lt; 0 &amp;&amp; start &gt; millis());</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="keywordflow">if</span> (_nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> &lt;= 0){</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> = 0;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      result = <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42ae41f591ecb2a3c7f0b22194cde6fac8c">WL_NO_SSID_AVAIL</a>;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="preprocessor">      #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        Serial.println(<span class="stringliteral">&quot;no network found&quot;</span>);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="preprocessor">      #endif</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <span class="keywordflow">for</span>(uint8_t i=0; i&lt;_nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a>; i++) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        strcpy(ssidNet, <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a0d4b45ce1ad3338b51c1e2bed438ab79">SSID</a>(i).c_str());</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <span class="keywordflow">for</span>(uint8_t j=0; j&lt;<a class="code" href="WiFi2Control_8h.html#a1ca079faac5937dd224e346d841ccb81">MAX_NETWORK_LIST</a>; j++){</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;          <span class="keywordflow">if</span>(strcmp((<span class="keywordtype">char</span>*)ssidNet, <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[j].strSSID) == 0) {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            found = <span class="keyword">true</span>;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.lastConnected == j){  <span class="comment">//last connected -&gt; connect directly</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;              <a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a> = j;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="preprocessor">              #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                Serial.println(<span class="stringliteral">&quot;Connect to the last connected&quot;</span>);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="preprocessor">              #endif</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;              <span class="keywordflow">break</span>;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            }</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            tempRssi = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a1af6ef55e20b1f1c3a7913049a0b54ab">RSSI</a>(i);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            <span class="keywordflow">if</span>(rssi &lt; tempRssi) {</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;              rssi = tempRssi;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;              <a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a> = j;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            }</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;          }</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        }</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="keywordflow">if</span>(found)</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;          <span class="keywordflow">break</span>;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        memset(ssidNet, 0, 33);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      }</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    }</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="comment">// a network match found</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a> &gt;= 0) {</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="preprocessor">      #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        Serial.print(<span class="stringliteral">&quot;\nSSID: &quot;</span>);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        Serial.println((<span class="keywordtype">char</span> *)<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>].strSSID);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        Serial.print(<span class="stringliteral">&quot;PWD: &quot;</span>);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        Serial.println((<span class="keywordtype">char</span> *)<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>].strPWD);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="preprocessor">      #endif</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      </div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a20e71a9130244ededffc081c9891fb07">status</a>() == <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a321b58e6917f8ba6733b1e9ebef51e9b">WL_CONNECTED</a>){</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        <span class="comment">//if(networkArray.netEntry[connectedIndex_temp].strSSID != Config.getParam(&quot;ssid&quot;).c_str() != ssidNet)</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;          <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a4fb9b420236be7d67dfb2a72ec47d308">disconnect</a>();</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#a57360801d1b6db9b2e2d8c91fd5a74e6">connectionTimeout</a> = millis() + <a class="code" href="WiFi2Control_8h.html#a0c63390af22aa0f877eece67372a7414">CONNECTION_TIMEOUT</a>;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#ad6cc679f93b3baa8a0c966e77cf62795">connectionStatus</a> = <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a23eb406d022f014ca5cc982dc3d3d681">WL_IDLE_STATUS</a>;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#af199a17c86b974212683cc0ec46c8875">begin</a>(<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>].strSSID, <a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>.netEntry[<a class="code" href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">connectedIndex_temp</a>].strPWD);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    }</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="preprocessor">      #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        Serial.println(<span class="stringliteral">&quot;No network memorized or match found&quot;</span>);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="preprocessor">      #endif</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="comment">//get parameter</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;    <a class="code" href="WiFi2Control_8h.html#a3885688bb9493b027cdb27a23a3d0149">tsParameter</a> ssid = {</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      .len = _tempPkt.dataPtr[0],</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      .paramPtr = (uint8_t *)(_tempPkt.dataPtr + 1),</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    };</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordtype">char</span> pwdBuf[65];</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    <span class="comment">// string size + terminator</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordtype">char</span> ssidBuf[ssid.len + 1];</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    memset(ssidBuf, 0, ssid.len + 1);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    memcpy(ssidBuf, ssid.paramPtr, ssid.len);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    ssidBuf[ssid.len] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    </div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    <span class="comment">// Open network, connection without password</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">if</span> (option == 0) {</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a20e71a9130244ededffc081c9891fb07">status</a>() == <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a321b58e6917f8ba6733b1e9ebef51e9b">WL_CONNECTED</a>){</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="comment">//if(networkArray.netEntry[connectedIndex_temp].strSSID != Config.getParam(&quot;ssid&quot;).c_str() != ssidNet)</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;          <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a4fb9b420236be7d67dfb2a72ec47d308">disconnect</a>();</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      }</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#a57360801d1b6db9b2e2d8c91fd5a74e6">connectionTimeout</a> = millis() + <a class="code" href="WiFi2Control_8h.html#a0c63390af22aa0f877eece67372a7414">CONNECTION_TIMEOUT</a>;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#ad6cc679f93b3baa8a0c966e77cf62795">connectionStatus</a> = <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a23eb406d022f014ca5cc982dc3d3d681">WL_IDLE_STATUS</a>;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      </div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="comment">//set network and retrieve result</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#af199a17c86b974212683cc0ec46c8875">begin</a>(ssidBuf);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      memset(<a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strSSID, 0, 33);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      memset(<a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strPWD, 0, 65);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.aging = 0;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      strcpy(<a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strSSID, ssidBuf);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#aff215dbd9b5148412da2cc8e67f80579">connectionRequested</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    }</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <span class="comment">// secured network, connection with password</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (option == 1) {</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <span class="comment">//get parameter</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <a class="code" href="WiFi2Control_8h.html#a3885688bb9493b027cdb27a23a3d0149">tsParameter</a> pwd = {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        .len = _tempPkt.dataPtr[ssid.len + 1],</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        .paramPtr = (uint8_t *)(_tempPkt.dataPtr + ssid.len + 2),</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      };</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      <span class="comment">// string size + terminator</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="comment">//char pwdBuf[pwd.len + 1];</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      memset(pwdBuf, 0, pwd.len + 1);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      memcpy(pwdBuf, pwd.paramPtr, pwd.len);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      pwdBuf[pwd.len] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      Serial.print(<span class="stringliteral">&quot;\nSSID: &quot;</span>);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      Serial.println((<span class="keywordtype">char</span> *)ssidBuf);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      Serial.print(<span class="stringliteral">&quot;PWD: &quot;</span>);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      Serial.println((<span class="keywordtype">char</span> *)pwdBuf);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a20e71a9130244ededffc081c9891fb07">status</a>() == <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a321b58e6917f8ba6733b1e9ebef51e9b">WL_CONNECTED</a>){</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="comment">//if(networkArray.netEntry[connectedIndex_temp].strSSID != Config.getParam(&quot;ssid&quot;).c_str() != ssidNet)</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;          <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a4fb9b420236be7d67dfb2a72ec47d308">disconnect</a>();</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      }</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#a57360801d1b6db9b2e2d8c91fd5a74e6">connectionTimeout</a> = millis() + <a class="code" href="WiFi2Control_8h.html#a0c63390af22aa0f877eece67372a7414">CONNECTION_TIMEOUT</a>;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#ad6cc679f93b3baa8a0c966e77cf62795">connectionStatus</a> = <a class="code" href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a23eb406d022f014ca5cc982dc3d3d681">WL_IDLE_STATUS</a>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <span class="comment">//set network and retrieve result</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#af199a17c86b974212683cc0ec46c8875">begin</a>(ssidBuf, pwdBuf);</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      memset(<a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strSSID, 0, 33);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      memset(<a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strPWD, 0, 65);</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.aging = 0;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      strcpy(<a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strSSID, ssidBuf);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      strcpy(<a class="code" href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">tempNetworkParam</a>.strPWD, pwdBuf);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <a class="code" href="classWiFi2ControlClass.html#aff215dbd9b5148412da2cc8e67f80579">connectionRequested</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      <span class="comment">//_createErrorResponse();</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    }</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  }</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;}</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="keywordtype">bool</span> WiFi2ControlClass::_disconnect()</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;{</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  <span class="keywordtype">bool</span> ret = <span class="keyword">false</span>;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="comment">//Disconnet from the network</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  uint8_t result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a4fb9b420236be7d67dfb2a72ec47d308">disconnect</a>();</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;}</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">//ok</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">* START_CMD, CMD | REPLY_FLAG, PARAM_NUMS_1, PARAM_SIZE_1, numNets, END_CMD</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_startScanNetwork()</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;{</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="comment">//scanNetworks command</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#aceb4deceab051045bd1000b6ca295fe3">scanNetworks</a>();</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  </div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  <span class="keywordflow">if</span> (_nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> &lt; 0)</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;    _nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a> = 0;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <span class="comment">//set the response struct</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>((uint8_t*)&amp;_nets.<a class="code" href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">nScannedNets</a>, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;}</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">* START_CMD, CMD | REPLY_FLAG, NET_NUMBER, SSID_LEN, SSID_NAME, END_CMD</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_scanNetwork(uint8_t which)</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;{</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  String ssidNet = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a0d4b45ce1ad3338b51c1e2bed438ab79">SSID</a>(which);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  uint8_t enc = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a893073f5a619a72d9ff54778fc26d489">encryptionType</a>(which);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  int32_t rssi = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a1af6ef55e20b1f1c3a7913049a0b54ab">RSSI</a>(which);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  delay(10);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;  uint32_t result = ssidNet.length() + <span class="keyword">sizeof</span>(enc) + <span class="keyword">sizeof</span>(rssi) + 2;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  uint8_t buff[result];</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  buff[0] = which;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  buff[1] = (uint8_t)rssi;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  buff[2] = 0xff;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  buff[3] = 0xff;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  buff[4] = 0xff;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  buff[5] = enc;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  buff[6] = ssidNet.length();</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  memcpy((buff + 7), ssidNet.c_str(), ssidNet.length());</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();  </div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#aa8e7e66d3cdeee5f3384130fff14d152">sendDataPkt</a>(_tempPkt.cmd);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a3137df25dd09e15bd7f2efa996f4deb0">appendBuffer</a>(buff, result);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;}</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getBSSID()</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;{</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  <span class="keywordtype">int</span> paramLen = 6;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  uint8_t idx = 0; <span class="comment">//network index</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  uint8_t *result;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  <span class="comment">//Retrive the BSSID</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a77b00e7d0ca50232887211288bb4dcd5">BSSID</a>();</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="comment">//set the response struct</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(result, paramLen, LAST_PARAM);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;}</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_config()</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;{</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="keywordtype">bool</span> result;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  uint8_t validParams = 0;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  uint8_t stip0, stip1, stip2, stip3,</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    gwip0, gwip1, gwip2, gwip3,</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    snip0, snip1, snip2, snip3;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  validParams = _tempPkt.dataPtr[1];</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  <span class="comment">//retrieve the static IP address</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  stip0 = _tempPkt.dataPtr[3];</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  stip1 = _tempPkt.dataPtr[4];</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  stip2 = _tempPkt.dataPtr[5];</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  stip3 = _tempPkt.dataPtr[6];</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  _handyIp = <span class="keyword">new</span> IPAddress(stip0, stip1, stip2, stip3);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="comment">//retrieve the gateway IP address</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  gwip0 = _tempPkt.dataPtr[8];</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  gwip1 = _tempPkt.dataPtr[9];</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  gwip2 = _tempPkt.dataPtr[10];</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  gwip3 = _tempPkt.dataPtr[11];</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  _handyGateway = <span class="keyword">new</span> IPAddress(gwip0, gwip1, gwip2, gwip3);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  <span class="comment">//retrieve the subnet mask</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  snip0 = _tempPkt.dataPtr[13];</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  snip1 = _tempPkt.dataPtr[14];</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  snip2 = _tempPkt.dataPtr[15];</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  snip3 = _tempPkt.dataPtr[16];</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;  _handySubnet = <span class="keyword">new</span> IPAddress(snip0, snip1, snip2, snip3);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#af63e365e6e89d4f3a1c4715df29e07bd">config</a>(*_handyIp, *_handyGateway, *_handySubnet);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>((uint8_t*)&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;}</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_setDNS()</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;{</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  <span class="keywordtype">bool</span> result;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  uint8_t validParams = 0;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  validParams = _tempPkt.dataPtr[1];</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  uint8_t dns1ip0, dns1ip1, dns1ip2, dns1ip3,</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    dns2ip0, dns2ip1, dns2ip2, dns2ip3;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="comment">//retrieve the dns 1 address</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  dns1ip0 = _tempPkt.dataPtr[3];</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  dns1ip1 = _tempPkt.dataPtr[4];</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  dns1ip2 = _tempPkt.dataPtr[5];</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  dns1ip3 = _tempPkt.dataPtr[6];</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  IPAddress dns1(dns1ip0, dns1ip1, dns1ip2, dns1ip3);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  <span class="comment">//retrieve the dns 2 address</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  dns2ip0 = _tempPkt.dataPtr[8];</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  dns2ip1 = _tempPkt.dataPtr[9];</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  dns2ip2 = _tempPkt.dataPtr[10];</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  dns2ip3 = _tempPkt.dataPtr[11];</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  IPAddress dns2(dns2ip0, dns2ip1, dns2ip2, dns2ip3);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#af63e365e6e89d4f3a1c4715df29e07bd">config</a>(*_handyIp, *_handyGateway, *_handySubnet, dns1, dns2);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>((uint8_t*)&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;}</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getHostByName()</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;{</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  uint8_t result;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  IPAddress _reqHostIp;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordtype">char</span> host[_tempPkt.dataPtr[0]+1];</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="comment">//get the host name to look up</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  <span class="comment">//strncpy(host, _reqPckt.params[0].param, _reqPckt.params[0].paramLen);</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  memcpy(host, &amp;_tempPkt.dataPtr[1], _tempPkt.dataPtr[0]);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  host[_tempPkt.dataPtr[0]] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  result = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#ac4a9df3349c6e228abeb28c7c5fce46f">hostByName</a>(host, _reqHostIp); <span class="comment">//retrieve the ip address of the host</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  </div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  <span class="keywordflow">if</span>(result == 0){ <span class="comment">// call failed, return 0</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  }</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordflow">else</span>{ <span class="comment">//call succeded, return host&#39;s ip</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    uint8_t res[4] = {_reqHostIp.operator[](0), _reqHostIp.operator[](1), _reqHostIp.operator[](2), _reqHostIp.operator[](3)};</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(res, PARAM_SIZE_4, LAST_PARAM);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  }</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;}</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getNetworkData()</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;{</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  IPAddress localIp, subnetMask, gatewayIp; <span class="comment">//, dnsIp1, dnsIp2;</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  subnetMask = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#add60a0aa242df0c996bee49aa432bddd">subnetMask</a>();</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  gatewayIp = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#a16d5a8f8fd868aebc9606d69f68a5ba0">gatewayIP</a>();</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;  localIp = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#aaaa629c280812c7aabfa465ed5b578fb">localIP</a>();</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  </div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  uint32_t tim = millis() + 5000;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  <span class="keywordflow">while</span>(localIp.operator[](0) == 0 &amp;&amp; millis() &lt; tim){</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    delay(1);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    localIp = <a class="code" href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a>.<a class="code" href="classControl2WiFi.html#aaaa629c280812c7aabfa465ed5b578fb">localIP</a>();</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  }</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  <span class="comment">//set the response struct</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_3);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  uint8_t res[4] = {localIp.operator[](0), localIp.operator[](1), localIp.operator[](2), localIp.operator[](3)};</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(res, PARAM_SIZE_4, NO_LAST_PARAM);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  res[0] = subnetMask.operator[](0);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  res[1] = subnetMask.operator[](1);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  res[2] = subnetMask.operator[](2);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  res[3] = subnetMask.operator[](3);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(res, PARAM_SIZE_4, NO_LAST_PARAM);</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  res[0] = gatewayIp.operator[](0);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  res[1] = gatewayIp.operator[](1);</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  res[2] = gatewayIp.operator[](2);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  res[3] = gatewayIp.operator[](3);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(res, PARAM_SIZE_4, LAST_PARAM);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;}</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="comment">/* WiFI Server */</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_startServer()</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;{</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  uint8_t result = 0;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  uint8_t _p1 = _tempPkt.dataPtr[1];</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  uint8_t _p2 = _tempPkt.dataPtr[2];</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  <span class="comment">//retrieve the port to start server</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  uint16_t port = (_p1 &lt;&lt; 8) + _p2;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="comment">//retrieve sockets number</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  uint8_t sock = _tempPkt.dataPtr[4];</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  <span class="comment">//retrieve protocol mode (TCP/UDP)</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  uint8_t prot = _tempPkt.dataPtr[6];</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  <span class="keywordflow">if</span> (sock &lt; <a class="code" href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a>)</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  {</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="keywordflow">if</span> (prot == <a class="code" href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a>)</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    { <span class="comment">//TCP MODE</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="keywordflow">if</span> (_mapWiFiServers[sock] != NULL)</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="comment">//_mapWiFiServers[_sock]-&gt;stop();</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        _mapWiFiServers[sock]-&gt;close();</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        free(_mapWiFiServers[sock]);</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;      }</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <span class="keywordflow">if</span> (port == 80)</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      {</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        <span class="comment">//UIserver.stop();      //stop UI SERVER</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        <a class="code" href="classWiFi2ControlClass.html#a7291ed031876956bc6380e46882c4037">UI_alert</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      }</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      _mapWiFiServers[sock] = <span class="keyword">new</span> <a class="code" href="classWiFiServer.html">WiFiServer</a>(port);</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      _mapWiFiServers[sock]-&gt;<a class="code" href="classWiFiServer.html#a953b3d2a3ea0b0582be9535b6aa908d9">begin</a>();</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      result = 1;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    }</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    { <span class="comment">//UDP MODE</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="comment">//if (_mapWiFiUDP[_sock] != NULL)</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      {</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        _mapWiFiUDP[sock].<a class="code" href="classWiFiUDP.html#afe257ae094929d75352c44bab8635d28">stop</a>();</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      }</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      _mapWiFiUDP[sock].<a class="code" href="classWiFiUDP.html#a5096e4634afee38816ad15f08802185e">begin</a>(port);</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      _port[sock] = port;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      _sockInUse[sock].<a class="code" href="structtsSockStatus.html#a7e375aca04796b0e1dd152f3fa00e0cd">inUse</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      _sockInUse[sock].<a class="code" href="structtsSockStatus.html#ae3aa4acc04c59c0bea282b682be9ab8d">protocol</a> = <a class="code" href="WiFi2Control_8h.html#afb5ebfaff9a32a76648ad89c0ab05a11">PROT_UDP</a>;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      result = 1;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    }</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  }</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  <span class="comment">//set the response struct</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;}</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getData()</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;{</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  uint8_t result = 0;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="comment">//retrieve socket index</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  uint8_t _sock = _tempPkt.dataPtr[1];</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <span class="comment">//retrieve peek</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  uint8_t _p1 = _tempPkt.dataPtr[3];</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  uint8_t _p2 = _tempPkt.dataPtr[4];</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  uint16_t _peek = (_p1 &lt;&lt; 8) + _p2;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordflow">if</span>(_sockInUse[_sock].protocol == <a class="code" href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a>){</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <span class="keywordflow">if</span>(_mapWiFiClients[_sock].available() &gt; 0){</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="keywordflow">if</span> (_peek &gt; 0) {</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        result = _mapWiFiClients[_sock].<a class="code" href="classWiFiClient.html#ab47076806232cb80dbabbaa832919d84">peek</a>();</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      }</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        result = _mapWiFiClients[_sock].<a class="code" href="classWiFiClient.html#a823bdc93651f12103ec4dddb4ee8581d">read</a>();</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <span class="keywordflow">if</span> (_oldDataClient[_sock])</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;          _oldDataClient[_sock]--;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      }</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    }</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  }</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  <span class="keywordflow">else</span> <span class="comment">// PROT_UDP</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  {</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordflow">if</span> (_peek &gt; 0) {</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;      result = _mapWiFiUDP[_sock].<a class="code" href="classWiFiUDP.html#acc1e49165e78981144d30bd97f2cc8ed">peek</a>();</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    }</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      result = _mapWiFiUDP[_sock].<a class="code" href="classWiFiUDP.html#a943987cacff3c7a0e03f6ae0d7efd73e">read</a>();</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    }</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  }</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="comment">//set the response struct</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;}</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">/* WiFi Client */</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_stopClient()</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;{</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  uint8_t result = 0;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  uint8_t _sock = _tempPkt.dataPtr[1];</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  <span class="keywordflow">if</span> (_sock &lt; <a class="code" href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a>)</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  {</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keywordflow">if</span> (_sockInUse[_sock].protocol == <a class="code" href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a>)</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    {</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;      _mapWiFiClients[_sock].<a class="code" href="classWiFiClient.html#a43c3ec6dfd681de3eacb1b0ec835991f">stop</a>();</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;      _oldDataClient[_sock] = 0;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;      _sockInUse[_sock].<a class="code" href="structtsSockStatus.html#a7e375aca04796b0e1dd152f3fa00e0cd">inUse</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      result = 1;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    }</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="keywordflow">else</span> <span class="comment">// PROT_UDP</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    {</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;      _mapWiFiUDP[_sock].<a class="code" href="classWiFiUDP.html#afe257ae094929d75352c44bab8635d28">stop</a>();</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      _oldDataClient[_sock] = 0;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      _sockInUse[_sock].<a class="code" href="structtsSockStatus.html#a7e375aca04796b0e1dd152f3fa00e0cd">inUse</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      result = 1;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    }</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  }</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;  <span class="comment">//set the response struct</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;}</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_clientStatus()</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;{</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  uint8_t result = 0;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  uint8_t _sock = (uint8_t)_tempPkt.dataPtr[1];</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  if (_sock &lt; <a class="code" href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a>) {</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keywordflow">if</span> (!_mapWiFiClients[_sock]) { <span class="comment">//_mapWiFiClients[_sock] == NULL</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <span class="keywordflow">if</span> (_mapWiFiServers[_sock] != NULL) {</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        _mapWiFiClients[_sock] = _mapWiFiServers[_sock]-&gt;<a class="code" href="classWiFiServer.html#abfd839b75fa3c40bd5e22c4a122ed800">available</a>(); <span class="comment">//Create the client from the server [Arduino as a Server]</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="comment">// [cr] TODO - status function on client is not implemented. check for alternatives</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        result = 0; <span class="comment">//_mapWiFiClients[_sock].status();</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      }</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      <span class="comment">// [cr] TODO - status function on client is not implemented. check for alternatives</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      result = 0; <span class="comment">//_mapWiFiClients[_sock].status();</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    }</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  }</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <span class="comment">//set the response struct</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_2);</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;_sock, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;}</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="keywordtype">bool</span> WiFi2ControlClass::_sendData()</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;{</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="keywordflow">if</span>(_tempPkt.cmdType == DATA_PKT &amp;&amp; <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.endReceived() == <span class="keyword">false</span>) {</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <span class="keywordflow">if</span>(_tempPkt.nParam == 26) {</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      <span class="comment">// socket number is the first byte in packet payload</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      _sockNumber = _tempPkt.dataPtr[0];</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      _sockBuffInit();</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      _sockBuffAdd(&amp;_tempPkt.dataPtr[1], _tempPkt.nParam - 1);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    }</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      _sockBuffAdd(_tempPkt.dataPtr, _tempPkt.nParam);</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    }</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  }</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="keywordflow">if</span>(_tempPkt.nParam == 255){ <span class="comment">// 255 indicates a special case where data packet payload fits 1 packet</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      <span class="comment">// socket number is the first byte in packet payload</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      _sockNumber = _tempPkt.dataPtr[0];</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;      _sockBuffInit();</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;      _sockBuffAdd(&amp;_tempPkt.dataPtr[1], _tempPkt.totalLen);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    }</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      _sockBuffAdd(_tempPkt.dataPtr, _tempPkt.nParam);</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;    }</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      <span class="comment">//Serial.print(&quot;\r\nsocket msg: &quot;);</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;     <span class="comment">//Serial.write(_dataBuf, _dataBufSz);</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  </div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    uint8_t _sock = _sockNumber;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    uint32_t result = 0;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    uint8_t tcpResult = 0;</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    </div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">if</span> (_sock &lt; <a class="code" href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a> &amp;&amp; _sockInUse[_sock].inUse) {</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="keywordflow">if</span>(_sockInUse[_sock].protocol == <a class="code" href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a>)</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        <span class="keywordflow">if</span> (_mapWiFiClients[_sock].connected()){</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;          <span class="comment">// empty client&#39;s cache before writing the response</span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;          <span class="keywordflow">while</span>(_mapWiFiClients[_sock].available()){</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;            _mapWiFiClients[_sock].<a class="code" href="classWiFiClient.html#a823bdc93651f12103ec4dddb4ee8581d">read</a>();</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;          }</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;          result = _mapWiFiClients[_sock].<a class="code" href="classWiFiClient.html#a48db220c84756ab99fc6356901ded0f9">write</a>((uint8_t *)(_dataBuf), _dataBufSz);</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        }</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      }</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <span class="keywordflow">else</span> <span class="comment">//PROT_UDP</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      { </div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        result = _mapWiFiUDP[_sock].<a class="code" href="classWiFiUDP.html#a829b5a2603213aae061ca72f68c9ef41">write</a>((uint8_t *)(_dataBuf), _dataBufSz);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      }</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;      <span class="keywordflow">if</span> (result == _dataBufSz)</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        tcpResult = 1;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        tcpResult = 0;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    }</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  }</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  </div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;}</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_startClient()</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;{</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  uint8_t result = 0;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  <span class="keywordtype">int</span> sock;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  uint16_t port;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  uint8_t prot;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="comment">//retrieve the IP address to connect to</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  uint8_t stip1 = _tempPkt.dataPtr[1];</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  uint8_t stip2 = _tempPkt.dataPtr[2];</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  uint8_t stip3 = _tempPkt.dataPtr[3];</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  uint8_t stip4 = _tempPkt.dataPtr[4];</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  IPAddress ip(stip1, stip2, stip3, stip4);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;  <span class="comment">//retrieve the _port to connect to</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  uint8_t _p1 = _tempPkt.dataPtr[6];</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  uint8_t _p2 = _tempPkt.dataPtr[7];</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  port = (_p1 &lt;&lt; 8) + _p2;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  <span class="comment">//retrieve sockets number</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  sock = (int)_tempPkt.dataPtr[9];</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  <span class="comment">//retrieve protocol mode (TCP/UDP)</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  prot = _tempPkt.dataPtr[11];</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  if (sock &lt; <a class="code" href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a>) {</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keywordflow">if</span> (prot == <a class="code" href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a>) {</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <span class="comment">//TCP MODE</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      <span class="keywordflow">if</span> (_mapWiFiClients[sock]) {</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        _mapWiFiClients[sock].<a class="code" href="classWiFiClient.html#a43c3ec6dfd681de3eacb1b0ec835991f">stop</a>();</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        _oldDataClient[sock] = 0;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        _sockInUse[sock].<a class="code" href="structtsSockStatus.html#a7e375aca04796b0e1dd152f3fa00e0cd">inUse</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      }</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      result = _mapWiFiClients[sock].<a class="code" href="classWiFiClient.html#a9a980afa20a5b18a169837156153a91e">connect</a>(ip, port);</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      <span class="keywordflow">if</span>(result){</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        _sockInUse[sock].<a class="code" href="structtsSockStatus.html#a7e375aca04796b0e1dd152f3fa00e0cd">inUse</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        _sockInUse[sock].<a class="code" href="structtsSockStatus.html#aaabca1f6fb1e74552fd62311a0349bb2">conn</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        _sockInUse[sock].<a class="code" href="structtsSockStatus.html#ae3aa4acc04c59c0bea282b682be9ab8d">protocol</a> = <a class="code" href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a>;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      }</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    }</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      <span class="comment">//UDP MODE</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      result = _mapWiFiUDP[sock].<a class="code" href="classWiFiUDP.html#a4020465ab25cf3b88e23e6bb675e0eee">beginPacket</a>(ip, port);</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      _sockInUse[sock].<a class="code" href="structtsSockStatus.html#ae3aa4acc04c59c0bea282b682be9ab8d">protocol</a> = <a class="code" href="WiFi2Control_8h.html#afb5ebfaff9a32a76648ad89c0ab05a11">PROT_UDP</a>;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    }</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  }</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  <span class="comment">//set the response struct</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;}</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment">/* WiFi UDP Client */</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_remoteData()</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;{</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  uint8_t _sock;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;  <span class="comment">//retrieve sockets number</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  _sock = _tempPkt.dataPtr[1];</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;  <span class="keywordflow">if</span> (_sock &lt; <a class="code" href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a> <span class="comment">/*&amp;&amp; _mapWiFiUDP[_sock] != NULL*/</span>)</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;  {</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    IPAddress remoteIp = _mapWiFiUDP[_sock].<a class="code" href="classWiFiUDP.html#a59f0cc4a8a6b282df4aa714729f28d4d">remoteIP</a>();</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    uint16_t remotePort = _mapWiFiUDP[_sock].<a class="code" href="classWiFiUDP.html#afbb462d4239b67348c430828b4b43f9b">remotePort</a>();</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;      </div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="comment">//set the response struct</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_2);</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    uint8_t res[4] = {remoteIp.operator[](0), remoteIp.operator[](1), remoteIp.operator[](2), remoteIp.operator[](3)};</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(res, PARAM_SIZE_4, NO_LAST_PARAM);</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(remotePort, LAST_PARAM);</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  }</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  {</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="comment">// send 0 to report an error</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    uint8_t res = 0;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;res, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  }</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;}</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_getDataBuf()</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;{</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  int32_t result = 0;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;  uint8_t _sock = _tempPkt.dataPtr[1];</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;  uint16_t _len = _tempPkt.dataPtr[4] + (_tempPkt.dataPtr[3] &lt;&lt; 8);</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  </div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="keywordflow">if</span> (_sock &lt; <a class="code" href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a>) {</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keywordflow">if</span> (_sockInUse[_sock].protocol == <a class="code" href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a>) {</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      int32_t len = (_mapWiFiClients[_sock].<a class="code" href="classWiFiClient.html#a027090f7f03b80180d23316cf2647cf8">available</a>() &lt; _len) ? _mapWiFiClients[_sock].available() : _len;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      <span class="keywordflow">if</span>(len &gt; 0){</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        result = _mapWiFiClients[_sock].<a class="code" href="classWiFiClient.html#a823bdc93651f12103ec4dddb4ee8581d">read</a>(_dataBuf, len);</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        _oldDataClient[_sock] -= result;        </div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      }</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    }</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordflow">else</span> <span class="comment">//PROT_UDP</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    {</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;      <span class="comment">// read available data</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        result = _mapWiFiUDP[_sock].<a class="code" href="classWiFiUDP.html#a943987cacff3c7a0e03f6ae0d7efd73e">read</a>(_dataBuf, _len);</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    }</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  }</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;  </div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="preprocessor">  #ifdef DEBUG_SERIALE</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      <span class="comment">//Serial.print(&quot;\r\nget data buf &quot;);</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      <span class="comment">//Serial.println(result);</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  </div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#aa8e7e66d3cdeee5f3384130fff14d152">sendDataPkt</a>(_tempPkt.cmd);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a3137df25dd09e15bd7f2efa996f4deb0">appendBuffer</a>(_dataBuf, result);</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;}</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_sendEventPacket(uint8_t cmd, uint8_t sock, uint8_t *result, uint8_t resLen)</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;{</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(cmd, PARAM_NUMS_2);</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;sock, PARAM_SIZE_1, NO_LAST_PARAM);</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(result, resLen, LAST_PARAM);</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;  <span class="comment">// manually enable reception after each asynchronous event</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.enableRx();</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;}</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="comment">*</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_sendUdpData()</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;{</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;  uint8_t result = 0;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  uint8_t _sock = 0;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="comment">//retrieve socket index</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;  _sock = _tempPkt.dataPtr[1];</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;  <span class="keywordflow">if</span> (_sock &lt; <a class="code" href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a> <span class="comment">/*&amp;&amp; _mapWiFiUDP[_sock] != NULL*/</span>)</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  {</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="comment">//send data to client</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    result = _mapWiFiUDP[_sock].<a class="code" href="classWiFiUDP.html#a7132f319951c135ec7648ce1a51f02a9">endPacket</a>();</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    _mapWiFiUDP[_sock].<a class="code" href="classWiFiUDP.html#a5096e4634afee38816ad15f08802185e">begin</a>(_port[_sock]);</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;  }</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;  </div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  <span class="comment">//set the response struct</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.getLock();</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a9365d394a01fb982423e81a927521435">sendCmdPkt</a>(_tempPkt.cmd, PARAM_NUMS_1);</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.<a class="code" href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">sendParam</a>(&amp;result, PARAM_SIZE_1, LAST_PARAM);</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <a class="code" href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a>.releaseLock();</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;}</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_fetchWiFiSSIDList()</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;{</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  uint8_t val = 0;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  uint8_t* addr = (uint8_t*)&amp;<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;  <span class="keywordflow">for</span>(uint16_t i=0; i&lt;<span class="keyword">sizeof</span>(<a class="code" href="WiFi2Control_8h.html#aecbaeac0464f8d6daee9ffae2c2dd6e1">tsNetArray</a>); i++){</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    val = EEPROM.read(i);</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    memcpy((uint8_t*)(addr + i), (uint8_t*)&amp;val, 1);</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  }</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;}</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_storeWiFiSSIDList()</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;{</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;  uint8_t* addr = (uint8_t*)&amp;<a class="code" href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">networkArray</a>;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; 1024; i++) {</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    delay(1);</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <span class="keywordflow">if</span>(i &lt;= <span class="keyword">sizeof</span>(<a class="code" href="WiFi2Control_8h.html#aecbaeac0464f8d6daee9ffae2c2dd6e1">tsNetArray</a>)){</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      EEPROM.write(i, *((uint8_t*)(addr + i)));</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    }</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      EEPROM.write(i, 0xff);</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  }</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;  EEPROM.commit();</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;}</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="keywordtype">void</span> WiFi2ControlClass::_clearWiFiSSIDList()</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;{</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="keywordflow">for</span> (uint16_t i = 0; i &lt; 1024; i++) {</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    EEPROM.write(i, 0xff);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;  }</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  EEPROM.commit();</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;}</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;uint32_t WiFi2ControlClass::_sockBuffInit(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;{</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;  memset(_dataBuf, 0, <a class="code" href="WiFi2Control_8h.html#a3ffe523b678f356880d424f19f481010">MTU_SIZE</a>);</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  _dataBufSz = 0;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;}</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;uint32_t WiFi2ControlClass::_sockBuffAdd(uint8_t* data, uint32_t sz)</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;{</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  <span class="keywordflow">if</span>(_dataBufSz + sz &lt;= <a class="code" href="WiFi2Control_8h.html#a3ffe523b678f356880d424f19f481010">MTU_SIZE</a>){</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    memcpy((uint8_t*)(_dataBuf + _dataBufSz), data, sz);</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    _dataBufSz += sz;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  }</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  <span class="keywordflow">return</span> _dataBufSz;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;}</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div><div class="line"><a name="l01637"></a><span class="lineno"><a class="line" href="WiFi2Control_8h.html#a515783515458c562d6e4c6fb906264e2"> 1637</a></span>&#160;<a class="code" href="classWiFi2ControlClass.html">WiFi2ControlClass</a> <a class="code" href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a>;</div><div class="ttc" id="communication_8h_html"><div class="ttname"><a href="communication_8h.html">communication.h</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba3261512e88bf62679d958fb8f2d7b508"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba3261512e88bf62679d958fb8f2d7b508">CANCEL_NETWORK_LIST</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00034">CommCmd.h:34</a></div></div>
<div class="ttc" id="events_8h_html_a90585c4c60570404bc3323700ab03143"><div class="ttname"><a href="events_8h.html#a90585c4c60570404bc3323700ab03143">WiFi_stoppedSTA</a></div><div class="ttdeci">bool WiFi_stoppedSTA() __attribute__((weak))</div><div class="ttdoc">ESP32 station stop.</div></div>
<div class="ttc" id="communication_8cpp_html_acbef923ad22ef0461dd67c0aaf13c9d7"><div class="ttname"><a href="communication_8cpp.html#acbef923ad22ef0461dd67c0aaf13c9d7">communication</a></div><div class="ttdeci">Communication communication</div><div class="ttdef"><b>Definition:</b> <a href="communication_8cpp_source.html#l00384">communication.cpp:384</a></div></div>
<div class="ttc" id="classWiFiClient_html_a43c3ec6dfd681de3eacb1b0ec835991f"><div class="ttname"><a href="classWiFiClient.html#a43c3ec6dfd681de3eacb1b0ec835991f">WiFiClient::stop</a></div><div class="ttdeci">virtual void stop()</div><div class="ttdoc">Close connection to the remote server we are connected to.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiClient_8cpp_source.html#l00301">WiFiClient.cpp:301</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba6f2b4b1e20dd0b745f876a8fe4df0108"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba6f2b4b1e20dd0b745f876a8fe4df0108">GET_HOSTNAME</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00031">CommCmd.h:31</a></div></div>
<div class="ttc" id="classControl2WiFi_html_a1af6ef55e20b1f1c3a7913049a0b54ab"><div class="ttname"><a href="classControl2WiFi.html#a1af6ef55e20b1f1c3a7913049a0b54ab">Control2WiFi::RSSI</a></div><div class="ttdeci">int32_t RSSI()</div><div class="ttdoc">Return the current RSSI (Received Signal Strength in dBm) associated with the network we are connect ...</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l01032">Control2WiFi.cpp:1032</a></div></div>
<div class="ttc" id="classControl2WiFi_html_aaaa629c280812c7aabfa465ed5b578fb"><div class="ttname"><a href="classControl2WiFi.html#aaaa629c280812c7aabfa465ed5b578fb">Control2WiFi::localIP</a></div><div class="ttdeci">IPAddress localIP()</div><div class="ttdoc">Get the interface IP address.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l00844">Control2WiFi.cpp:844</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba52f7f1cecc99100c18be5b3b1c799728"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba52f7f1cecc99100c18be5b3b1c799728">SET_IP_CONFIG</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00029">CommCmd.h:29</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_ae931bf97db55e968fca362499cd00f4f"><div class="ttname"><a href="classWiFi2ControlClass.html#ae931bf97db55e968fca362499cd00f4f">WiFi2ControlClass::process</a></div><div class="ttdeci">friend bool process(void)</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8cpp_source.html#l00156">WiFi2Control.cpp:156</a></div></div>
<div class="ttc" id="events_8h_html_a8480c3a3426d23fac4e372a4c52d21a5"><div class="ttname"><a href="events_8h.html#a8480c3a3426d23fac4e372a4c52d21a5">WiFi_wpsEnrolleePinCode</a></div><div class="ttdeci">bool WiFi_wpsEnrolleePinCode() __attribute__((weak))</div><div class="ttdoc">ESP32 station wps pin code in enrollee mode.</div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55baeb2dc8b12016526b98289d01d742186c"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baeb2dc8b12016526b98289d01d742186c">START_SERVER_TCP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00052">CommCmd.h:52</a></div></div>
<div class="ttc" id="classWiFiUDP_html_a59f0cc4a8a6b282df4aa714729f28d4d"><div class="ttname"><a href="classWiFiUDP.html#a59f0cc4a8a6b282df4aa714729f28d4d">WiFiUDP::remoteIP</a></div><div class="ttdeci">virtual IPAddress remoteIP()</div><div class="ttdoc">Get the IP address of the host who sent the current incoming packet.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00399">WiFiUdp.cpp:399</a></div></div>
<div class="ttc" id="classWiFiClient_html_a027090f7f03b80180d23316cf2647cf8"><div class="ttname"><a href="classWiFiClient.html#a027090f7f03b80180d23316cf2647cf8">WiFiClient::available</a></div><div class="ttdeci">virtual int available()</div><div class="ttdoc">Check if there are available incoming data from remote server we are connected to.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiClient_8cpp_source.html#l00118">WiFiClient.cpp:118</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_a4334306b0831c95d5374d33b9b8ea190"><div class="ttname"><a href="classWiFi2ControlClass.html#a4334306b0831c95d5374d33b9b8ea190">WiFi2ControlClass::WiFi2ControlClass</a></div><div class="ttdeci">WiFi2ControlClass()</div><div class="ttdoc">class constructor.</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8cpp_source.html#l00180">WiFi2Control.cpp:180</a></div></div>
<div class="ttc" id="classWiFiUDP_html_a829b5a2603213aae061ca72f68c9ef41"><div class="ttname"><a href="classWiFiUDP.html#a829b5a2603213aae061ca72f68c9ef41">WiFiUDP::write</a></div><div class="ttdeci">virtual size_t write(uint8_t)</div><div class="ttdoc">Write a single byte into the packet.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00203">WiFiUdp.cpp:203</a></div></div>
<div class="ttc" id="WiFi2Control_8h_html_a1ca079faac5937dd224e346d841ccb81"><div class="ttname"><a href="WiFi2Control_8h.html#a1ca079faac5937dd224e346d841ccb81">MAX_NETWORK_LIST</a></div><div class="ttdeci">#define MAX_NETWORK_LIST</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00042">WiFi2Control.h:42</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_adf60e5fd33bab7bc7ff42755ec08d2cd"><div class="ttname"><a href="classWiFi2ControlClass.html#adf60e5fd33bab7bc7ff42755ec08d2cd">WiFi2ControlClass::connectedIndex_temp</a></div><div class="ttdeci">int8_t connectedIndex_temp</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00374">WiFi2Control.h:374</a></div></div>
<div class="ttc" id="classControl2WiFi_html_a20e71a9130244ededffc081c9891fb07"><div class="ttname"><a href="classControl2WiFi.html#a20e71a9130244ededffc081c9891fb07">Control2WiFi::status</a></div><div class="ttdeci">wl_status_t status()</div><div class="ttdoc">Get the connection status.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l01254">Control2WiFi.cpp:1254</a></div></div>
<div class="ttc" id="WiFi2Control_8h_html_a0c63390af22aa0f877eece67372a7414"><div class="ttname"><a href="WiFi2Control_8h.html#a0c63390af22aa0f877eece67372a7414">CONNECTION_TIMEOUT</a></div><div class="ttdeci">#define CONNECTION_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00032">WiFi2Control.h:32</a></div></div>
<div class="ttc" id="wifi__drv_8h_html_ae49487ef4d75cc4b24d6eb80266f8676"><div class="ttname"><a href="wifi__drv_8h.html#ae49487ef4d75cc4b24d6eb80266f8676">tsNewCmd</a></div><div class="ttdeci">tsNewCmd</div><div class="ttdef"><b>Definition:</b> <a href="wifi__drv_8h_source.html#l00058">wifi_drv.h:58</a></div></div>
<div class="ttc" id="events_8h_html_a88a76466fcafd878d030c6b96f7229c4"><div class="ttname"><a href="events_8h.html#a88a76466fcafd878d030c6b96f7229c4">WiFi_APreceivedProbe</a></div><div class="ttdeci">bool WiFi_APreceivedProbe() __attribute__((weak))</div><div class="ttdoc">Receive probe request packet in soft-AP interface.</div></div>
<div class="ttc" id="wl__definitions_8h_html_a8620f1e676d897f95fdbdc12bac59f42ae41f591ecb2a3c7f0b22194cde6fac8c"><div class="ttname"><a href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42ae41f591ecb2a3c7f0b22194cde6fac8c">WL_NO_SSID_AVAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="wl__definitions_8h_source.html#l00055">wl_definitions.h:55</a></div></div>
<div class="ttc" id="WiFi2Control_8cpp_html_ae931bf97db55e968fca362499cd00f4f"><div class="ttname"><a href="WiFi2Control_8cpp.html#ae931bf97db55e968fca362499cd00f4f">process</a></div><div class="ttdeci">bool process(void)</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8cpp_source.html#l00156">WiFi2Control.cpp:156</a></div></div>
<div class="ttc" id="classControl2WiFi_html_a0d4b45ce1ad3338b51c1e2bed438ab79"><div class="ttname"><a href="classControl2WiFi.html#a0d4b45ce1ad3338b51c1e2bed438ab79">Control2WiFi::SSID</a></div><div class="ttdeci">char * SSID()</div><div class="ttdoc">Get the current SSID associated with the network we are connected to.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l00951">Control2WiFi.cpp:951</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_ab581678b0591fa87238d7ad72e2e186b"><div class="ttname"><a href="classWiFi2ControlClass.html#ab581678b0591fa87238d7ad72e2e186b">WiFi2ControlClass::autoconnect</a></div><div class="ttdeci">bool autoconnect()</div><div class="ttdoc">try to connect to the first available network in the networks memorized list.</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8cpp_source.html#l00283">WiFi2Control.cpp:283</a></div></div>
<div class="ttc" id="events_8h_html_a3ace50bb44c40721572beae929fae20c"><div class="ttname"><a href="events_8h.html#a3ace50bb44c40721572beae929fae20c">WiFi_gotIPv6</a></div><div class="ttdeci">bool WiFi_gotIPv6() __attribute__((weak))</div><div class="ttdoc">ESP32 station or ap or ethernet interface v6IP addr is preferred.</div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba59f98cc3438e29f13e7d46d89ff9d9e0"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba59f98cc3438e29f13e7d46d89ff9d9e0">GET_IDX_RSSI</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00045">CommCmd.h:45</a></div></div>
<div class="ttc" id="classWiFiClient_html_aaf69c75c27d44c01484185e9306bd8da"><div class="ttname"><a href="classWiFiClient.html#aaf69c75c27d44c01484185e9306bd8da">WiFiClient::connected</a></div><div class="ttdeci">virtual uint8_t connected()</div><div class="ttdoc">Check if client is connected to a remote server.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiClient_8cpp_source.html#l00336">WiFiClient.cpp:336</a></div></div>
<div class="ttc" id="classWiFiUDP_html_a5096e4634afee38816ad15f08802185e"><div class="ttname"><a href="classWiFiUDP.html#a5096e4634afee38816ad15f08802185e">WiFiUDP::begin</a></div><div class="ttdeci">virtual uint8_t begin(uint16_t)</div><div class="ttdoc">initialize, start listening on specified port.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00039">WiFiUdp.cpp:39</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba259cff66ee612688d00b905734fe8718"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba259cff66ee612688d00b905734fe8718">GET_IDX_ENCT</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00046">CommCmd.h:46</a></div></div>
<div class="ttc" id="classControl2WiFi_html_a77b00e7d0ca50232887211288bb4dcd5"><div class="ttname"><a href="classControl2WiFi.html#a77b00e7d0ca50232887211288bb4dcd5">Control2WiFi::BSSID</a></div><div class="ttdeci">bool BSSID(uint8_t *bssid)</div><div class="ttdoc">Return the current BSSID associated with the network we are connected to.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l01002">Control2WiFi.cpp:1002</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_a57360801d1b6db9b2e2d8c91fd5a74e6"><div class="ttname"><a href="classWiFi2ControlClass.html#a57360801d1b6db9b2e2d8c91fd5a74e6">WiFi2ControlClass::connectionTimeout</a></div><div class="ttdeci">uint32_t connectionTimeout</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00371">WiFi2Control.h:371</a></div></div>
<div class="ttc" id="Control2WiFi_8cpp_html_a52e40566e4df4c69df6817390aecb59a"><div class="ttname"><a href="Control2WiFi_8cpp.html#a52e40566e4df4c69df6817390aecb59a">WiFi</a></div><div class="ttdeci">Control2WiFi WiFi</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l01330">Control2WiFi.cpp:1330</a></div></div>
<div class="ttc" id="classWiFiServer_html_abfd839b75fa3c40bd5e22c4a122ed800"><div class="ttname"><a href="classWiFiServer.html#abfd839b75fa3c40bd5e22c4a122ed800">WiFiServer::available</a></div><div class="ttdeci">WiFiClient available()</div><div class="ttdoc">Check if there are clients connected to our server.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiServer_8cpp_source.html#l00070">WiFiServer.cpp:70</a></div></div>
<div class="ttc" id="classCommunication_html_ab8fd407bc6d18b933335366b6e0b8912"><div class="ttname"><a href="classCommunication.html#ab8fd407bc6d18b933335366b6e0b8912">Communication::getRxBuffer</a></div><div class="ttdeci">uint8_t * getRxBuffer()</div><div class="ttdoc">Get a reference to the buffer storing data received from interface.</div><div class="ttdef"><b>Definition:</b> <a href="communication_8cpp_source.html#l00380">communication.cpp:380</a></div></div>
<div class="ttc" id="classWiFiClient_html_a48db220c84756ab99fc6356901ded0f9"><div class="ttname"><a href="classWiFiClient.html#a48db220c84756ab99fc6356901ded0f9">WiFiClient::write</a></div><div class="ttdeci">virtual size_t write(uint8_t)</div><div class="ttdoc">Write a single byte to the remote server.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiClient_8cpp_source.html#l00098">WiFiClient.cpp:98</a></div></div>
<div class="ttc" id="events_8h_html_aebc52eadd9e58437b13f8d1167771b03"><div class="ttname"><a href="events_8h.html#aebc52eadd9e58437b13f8d1167771b03">WiFi_disconnected</a></div><div class="ttdeci">bool WiFi_disconnected() __attribute__((weak))</div><div class="ttdoc">ESP32 station disconnected from AP.</div></div>
<div class="ttc" id="classWiFiClient_html_a9a980afa20a5b18a169837156153a91e"><div class="ttname"><a href="classWiFiClient.html#a9a980afa20a5b18a169837156153a91e">WiFiClient::connect</a></div><div class="ttdeci">virtual int connect(IPAddress ip, uint16_t port)</div><div class="ttdoc">Connect to a remote server.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiClient_8cpp_source.html#l00059">WiFiClient.cpp:59</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba8b3e8191eaf4fc5d2206a676224cb38e"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba8b3e8191eaf4fc5d2206a676224cb38e">GET_CLIENT_STATE_TCP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00060">CommCmd.h:60</a></div></div>
<div class="ttc" id="classControl2WiFi_html_ac4a9df3349c6e228abeb28c7c5fce46f"><div class="ttname"><a href="classControl2WiFi.html#ac4a9df3349c6e228abeb28c7c5fce46f">Control2WiFi::hostByName</a></div><div class="ttdeci">int hostByName(const char *aHostname, IPAddress &amp;aResult)</div><div class="ttdoc">Resolve the given hostname to an IP address.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l01287">Control2WiFi.cpp:1287</a></div></div>
<div class="ttc" id="WiFi2Control_8h_html_a3ffe523b678f356880d424f19f481010"><div class="ttname"><a href="WiFi2Control_8h.html#a3ffe523b678f356880d424f19f481010">MTU_SIZE</a></div><div class="ttdeci">#define MTU_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00044">WiFi2Control.h:44</a></div></div>
<div class="ttc" id="classCommunication_html_aa8e7e66d3cdeee5f3384130fff14d152"><div class="ttname"><a href="classCommunication.html#aa8e7e66d3cdeee5f3384130fff14d152">Communication::sendDataPkt</a></div><div class="ttdeci">void sendDataPkt(uint8_t cmd)</div><div class="ttdoc">Start sending a data packet to the companion chip with the specified command.</div><div class="ttdef"><b>Definition:</b> <a href="communication_8cpp_source.html#l00360">communication.cpp:360</a></div></div>
<div class="ttc" id="structtsNetworkParams_html_a300d6c3ed27b0f75cb5df805829af5d2"><div class="ttname"><a href="structtsNetworkParams.html#a300d6c3ed27b0f75cb5df805829af5d2">tsNetworkParams::currNetIdx</a></div><div class="ttdeci">uint8_t currNetIdx</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00074">WiFi2Control.h:74</a></div></div>
<div class="ttc" id="WiFi2Control_8h_html_a0bbedd1c32c7d28e62e0f50c2a235f31"><div class="ttname"><a href="WiFi2Control_8h.html#a0bbedd1c32c7d28e62e0f50c2a235f31">MAX_SOCK_NUMBER</a></div><div class="ttdeci">#define MAX_SOCK_NUMBER</div><div class="ttdoc">Maxmium number of socket.</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00039">WiFi2Control.h:39</a></div></div>
<div class="ttc" id="classWiFiUDP_html_acdff2434208d9cb0c32ef9f2a803764a"><div class="ttname"><a href="classWiFiUDP.html#acdff2434208d9cb0c32ef9f2a803764a">WiFiUDP::parsePacket</a></div><div class="ttdeci">virtual int parsePacket()</div><div class="ttdoc">Start processing the next available incoming packet.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00224">WiFiUdp.cpp:224</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba74f43c68ee50636995e146bb5e0f0c33"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba74f43c68ee50636995e146bb5e0f0c33">GET_HOST_BY_NAME</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00047">CommCmd.h:47</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55baad80dbc7e38debd3ae2b5b88603012f5"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baad80dbc7e38debd3ae2b5b88603012f5">CONNECT_SECURED_AP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00027">CommCmd.h:27</a></div></div>
<div class="ttc" id="events_8h_html_a66bcf2d8895a07a4ac6afd67b130744f"><div class="ttname"><a href="events_8h.html#a66bcf2d8895a07a4ac6afd67b130744f">WiFi_wpsEnrolleeSuccess</a></div><div class="ttdeci">bool WiFi_wpsEnrolleeSuccess() __attribute__((weak))</div><div class="ttdoc">ESP32 station wps succeeds in enrollee mode.</div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba4791d7bdc9285d0b1bc90f1d8987228c"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba4791d7bdc9285d0b1bc90f1d8987228c">START_SCAN_NETWORKS</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00048">CommCmd.h:48</a></div></div>
<div class="ttc" id="wl__definitions_8h_html_a8620f1e676d897f95fdbdc12bac59f42a41788794f8616c31855dc1c285682d74"><div class="ttname"><a href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a41788794f8616c31855dc1c285682d74">WL_DISCONNECTED</a></div><div class="ttdef"><b>Definition:</b> <a href="wl__definitions_8h_source.html#l00060">wl_definitions.h:60</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55bad322ee6f782ce9d1b2ec7e19cbf2e082"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bad322ee6f782ce9d1b2ec7e19cbf2e082">GET_REMOTE_DATA</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00063">CommCmd.h:63</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_a1ce1e440c6411dc6c474a1c51f1534fc"><div class="ttname"><a href="classWiFi2ControlClass.html#a1ce1e440c6411dc6c474a1c51f1534fc">WiFi2ControlClass::setWiFiConfig</a></div><div class="ttdeci">void setWiFiConfig(WiFiMode_t mode)</div><div class="ttdoc">initialize WiFi as access point or access point plus station mode.</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8cpp_source.html#l00234">WiFi2Control.cpp:234</a></div></div>
<div class="ttc" id="classControl2WiFi_html_a4fb9b420236be7d67dfb2a72ec47d308"><div class="ttname"><a href="classControl2WiFi.html#a4fb9b420236be7d67dfb2a72ec47d308">Control2WiFi::disconnect</a></div><div class="ttdeci">int disconnect(void)</div><div class="ttdoc">Disconnect from the network.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l00786">Control2WiFi.cpp:786</a></div></div>
<div class="ttc" id="events_8h_html_a45e7f3e16c714b5d1b24c567c4c101d0"><div class="ttname"><a href="events_8h.html#a45e7f3e16c714b5d1b24c567c4c101d0">WiFi_lostIP</a></div><div class="ttdeci">bool WiFi_lostIP() __attribute__((weak))</div><div class="ttdoc">ESP32 station lost IP and the IP is reset to 0.</div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba5aa962708eba267c096b88303b0a32c2"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba5aa962708eba267c096b88303b0a32c2">GET_IPADDR</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00036">CommCmd.h:36</a></div></div>
<div class="ttc" id="structtsSockStatus_html_a7e375aca04796b0e1dd152f3fa00e0cd"><div class="ttname"><a href="structtsSockStatus.html#a7e375aca04796b0e1dd152f3fa00e0cd">tsSockStatus::inUse</a></div><div class="ttdeci">bool inUse</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00078">WiFi2Control.h:78</a></div></div>
<div class="ttc" id="events_8h_html_ac1ca3f75344a3bafb5b284cf897fdee2"><div class="ttname"><a href="events_8h.html#ac1ca3f75344a3bafb5b284cf897fdee2">WiFi_wpsEnrolleeFailed</a></div><div class="ttdeci">bool WiFi_wpsEnrolleeFailed() __attribute__((weak))</div><div class="ttdoc">ESP32 station wps fails in enrollee mode.</div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba94e1b147729a78f4e0539f80c0a33eb3"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba94e1b147729a78f4e0539f80c0a33eb3">GET_MACADDR</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00037">CommCmd.h:37</a></div></div>
<div class="ttc" id="classControl2WiFi_html_aceb4deceab051045bd1000b6ca295fe3"><div class="ttname"><a href="classControl2WiFi.html#aceb4deceab051045bd1000b6ca295fe3">Control2WiFi::scanNetworks</a></div><div class="ttdeci">int8_t scanNetworks()</div><div class="ttdoc">Start scan WiFi networks available.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l01095">Control2WiFi.cpp:1095</a></div></div>
<div class="ttc" id="classControl2WiFi_html_ab5488e05c1389430b3f1a6aee091fcac"><div class="ttname"><a href="classControl2WiFi.html#ab5488e05c1389430b3f1a6aee091fcac">Control2WiFi::macAddress</a></div><div class="ttdeci">void macAddress(uint8_t *mac)</div><div class="ttdoc">Get the interface MAC address.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l00815">Control2WiFi.cpp:815</a></div></div>
<div class="ttc" id="classWiFiUDP_html_a943987cacff3c7a0e03f6ae0d7efd73e"><div class="ttname"><a href="classWiFiUDP.html#a943987cacff3c7a0e03f6ae0d7efd73e">WiFiUDP::read</a></div><div class="ttdeci">virtual int read()</div><div class="ttdoc">Read a single byte from the current packet.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00229">WiFiUdp.cpp:229</a></div></div>
<div class="ttc" id="classCommunication_html_ab0e54265d77a4368b54c8adff6966cff"><div class="ttname"><a href="classCommunication.html#ab0e54265d77a4368b54c8adff6966cff">Communication::handleCommEvents</a></div><div class="ttdeci">void handleCommEvents(void)</div><div class="ttdoc">handles communication events to see if an ISR has been detected</div><div class="ttdef"><b>Definition:</b> <a href="communication_8cpp_source.html#l00293">communication.cpp:293</a></div></div>
<div class="ttc" id="classWiFiServer_html_a953b3d2a3ea0b0582be9535b6aa908d9"><div class="ttname"><a href="classWiFiServer.html#a953b3d2a3ea0b0582be9535b6aa908d9">WiFiServer::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">Start the server on the port given by constructor.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiServer_8cpp_source.html#l00033">WiFiServer.cpp:33</a></div></div>
<div class="ttc" id="WiFi2Control_8h_html_aecbaeac0464f8d6daee9ffae2c2dd6e1"><div class="ttname"><a href="WiFi2Control_8h.html#aecbaeac0464f8d6daee9ffae2c2dd6e1">tsNetArray</a></div><div class="ttdeci">tsNetArray</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00061">WiFi2Control.h:61</a></div></div>
<div class="ttc" id="events_8h_html"><div class="ttname"><a href="events_8h.html">events.h</a></div></div>
<div class="ttc" id="events_8h_html_a95cfe4829716876554a40d54d01df6b9"><div class="ttname"><a href="events_8h.html#a95cfe4829716876554a40d54d01df6b9">WiFi_authModeChanged</a></div><div class="ttdeci">bool WiFi_authModeChanged() __attribute__((weak))</div><div class="ttdoc">the auth mode of AP connected by ESP32 station changed</div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55baa15f5a3da49f2db90e2961fe95e84b82"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa15f5a3da49f2db90e2961fe95e84b82">STOP_CLIENT_TCP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00059">CommCmd.h:59</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55badff0dd320f35248bacab96a25a5ac456"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55badff0dd320f35248bacab96a25a5ac456">GET_CURR_ENCT</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00041">CommCmd.h:41</a></div></div>
<div class="ttc" id="classWiFiClient_html_a823bdc93651f12103ec4dddb4ee8581d"><div class="ttname"><a href="classWiFiClient.html#a823bdc93651f12103ec4dddb4ee8581d">WiFiClient::read</a></div><div class="ttdeci">virtual int read()</div><div class="ttdoc">Read a single byte from remote server we are connected to.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiClient_8cpp_source.html#l00137">WiFiClient.cpp:137</a></div></div>
<div class="ttc" id="events_8h_html_a3be200855f4e561f9d14809793cfdd84"><div class="ttname"><a href="events_8h.html#a3be200855f4e561f9d14809793cfdd84">WiFi_APassignedIP2STA</a></div><div class="ttdeci">bool WiFi_APassignedIP2STA() __attribute__((weak))</div><div class="ttdoc">ESP32 soft-AP assign an IP to a connected station.</div></div>
<div class="ttc" id="classWiFiClient_html_ab47076806232cb80dbabbaa832919d84"><div class="ttname"><a href="classWiFiClient.html#ab47076806232cb80dbabbaa832919d84">WiFiClient::peek</a></div><div class="ttdeci">virtual int peek()</div><div class="ttdoc">Peek a single byte from remote server without removing it from the buffer.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiClient_8cpp_source.html#l00245">WiFiClient.cpp:245</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba399a55699ba7c64aa885b68c43d8675e"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba399a55699ba7c64aa885b68c43d8675e">GET_CURR_BSSID</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00039">CommCmd.h:39</a></div></div>
<div class="ttc" id="WiFi2Control_8h_html_a56ceccbbb11411d125bf8aaf48fcac21"><div class="ttname"><a href="WiFi2Control_8h.html#a56ceccbbb11411d125bf8aaf48fcac21">PROT_TCP</a></div><div class="ttdeci">#define PROT_TCP</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00046">WiFi2Control.h:46</a></div></div>
<div class="ttc" id="WiFi2Control_8h_html_a3885688bb9493b027cdb27a23a3d0149"><div class="ttname"><a href="WiFi2Control_8h.html#a3885688bb9493b027cdb27a23a3d0149">tsParameter</a></div><div class="ttdeci">tsParameter</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00070">WiFi2Control.h:70</a></div></div>
<div class="ttc" id="classControl2WiFi_html_af199a17c86b974212683cc0ec46c8875"><div class="ttname"><a href="classControl2WiFi.html#af199a17c86b974212683cc0ec46c8875">Control2WiFi::begin</a></div><div class="ttdeci">wl_status_t begin()</div><div class="ttdoc">Start Wifi connection by trying to connect to a network in the memorized networks list.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l00452">Control2WiFi.cpp:452</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_a3e1f8c8755a9876be81c5f260ed565d5"><div class="ttname"><a href="classWiFi2ControlClass.html#a3e1f8c8755a9876be81c5f260ed565d5">WiFi2ControlClass::poll</a></div><div class="ttdeci">void poll()</div><div class="ttdoc">function needed to check for commands or events.</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8cpp_source.html#l00225">WiFi2Control.cpp:225</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55bacc50362f1baf46b75ffc0f96153dc8a6"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bacc50362f1baf46b75ffc0f96153dc8a6">SEND_DATA_UDP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00062">CommCmd.h:62</a></div></div>
<div class="ttc" id="events_8h_html_ada707cf4ce2efd1f1609ca9dbab3b19f"><div class="ttname"><a href="events_8h.html#ada707cf4ce2efd1f1609ca9dbab3b19f">WiFi_ready</a></div><div class="ttdeci">bool WiFi_ready() __attribute__((weak))</div><div class="ttdoc">ESP32 WiFi ready.</div></div>
<div class="ttc" id="classWiFi2ControlClass_html_a38c689d36084e4457d5c3ee1c8ba25c9"><div class="ttname"><a href="classWiFi2ControlClass.html#a38c689d36084e4457d5c3ee1c8ba25c9">WiFi2ControlClass::startAutoconnect</a></div><div class="ttdeci">bool startAutoconnect</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00375">WiFi2Control.h:375</a></div></div>
<div class="ttc" id="WiFi2Control_8h_html_afb5ebfaff9a32a76648ad89c0ab05a11"><div class="ttname"><a href="WiFi2Control_8h.html#afb5ebfaff9a32a76648ad89c0ab05a11">PROT_UDP</a></div><div class="ttdeci">#define PROT_UDP</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00047">WiFi2Control.h:47</a></div></div>
<div class="ttc" id="CommCmd_8h_html"><div class="ttname"><a href="CommCmd_8h.html">CommCmd.h</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55bae3e0d811eb51e0e254a986391673ba81"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bae3e0d811eb51e0e254a986391673ba81">GET_CURR_SSID</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00038">CommCmd.h:38</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_ad6cc679f93b3baa8a0c966e77cf62795"><div class="ttname"><a href="classWiFi2ControlClass.html#ad6cc679f93b3baa8a0c966e77cf62795">WiFi2ControlClass::connectionStatus</a></div><div class="ttdeci">wl_status_t connectionStatus</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00372">WiFi2Control.h:372</a></div></div>
<div class="ttc" id="structtsNetworkParams_html_a34c8925d5a4ee0e11ced4dfc2ae7269a"><div class="ttname"><a href="structtsNetworkParams.html#a34c8925d5a4ee0e11ced4dfc2ae7269a">tsNetworkParams::nScannedNets</a></div><div class="ttdeci">int8_t nScannedNets</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00073">WiFi2Control.h:73</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba7705fb59ebe74fbbb033c16a7e20aade"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba7705fb59ebe74fbbb033c16a7e20aade">START_CLIENT_TCP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00058">CommCmd.h:58</a></div></div>
<div class="ttc" id="classWiFiUDP_html_afe257ae094929d75352c44bab8635d28"><div class="ttname"><a href="classWiFiUDP.html#afe257ae094929d75352c44bab8635d28">WiFiUDP::stop</a></div><div class="ttdeci">virtual void stop()</div><div class="ttdoc">Close the UDP socket.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00091">WiFiUdp.cpp:91</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_a0b46c3910fb26ebfb8a205491ba639a0"><div class="ttname"><a href="classWiFi2ControlClass.html#a0b46c3910fb26ebfb8a205491ba639a0">WiFi2ControlClass::notify</a></div><div class="ttdeci">bool notify</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00377">WiFi2Control.h:377</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html"><div class="ttname"><a href="classWiFi2ControlClass.html">WiFi2ControlClass</a></div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00088">WiFi2Control.h:88</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba1a471fdd11a8546f36d55b7e0a022921"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba1a471fdd11a8546f36d55b7e0a022921">COMPANION_READY</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00025">CommCmd.h:25</a></div></div>
<div class="ttc" id="classControl2WiFi_html_a893073f5a619a72d9ff54778fc26d489"><div class="ttname"><a href="classControl2WiFi.html#a893073f5a619a72d9ff54778fc26d489">Control2WiFi::encryptionType</a></div><div class="ttdeci">uint8_t encryptionType()</div><div class="ttdoc">Return the Encryption Type associated with the network we are connected to.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l01064">Control2WiFi.cpp:1064</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba9e82537489a18598044889b033f19191"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba9e82537489a18598044889b033f19191">GET_DATABUF_TCP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00068">CommCmd.h:68</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55bafdb0b5226be87f454e7063ad56afe92c"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bafdb0b5226be87f454e7063ad56afe92c">GET_DATA_TCP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00057">CommCmd.h:57</a></div></div>
<div class="ttc" id="WiFi2Control_8h_html"><div class="ttname"><a href="WiFi2Control_8h.html">WiFi2Control.h</a></div></div>
<div class="ttc" id="classControl2WiFi_html_af63e365e6e89d4f3a1c4715df29e07bd"><div class="ttname"><a href="classControl2WiFi.html#af63e365e6e89d4f3a1c4715df29e07bd">Control2WiFi::config</a></div><div class="ttdeci">bool config(IPAddress local_ip)</div><div class="ttdoc">Change Ip configuration settings disabling the dhcp client.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l00575">Control2WiFi.cpp:575</a></div></div>
<div class="ttc" id="classWiFiUDP_html_acc1e49165e78981144d30bd97f2cc8ed"><div class="ttname"><a href="classWiFiUDP.html#acc1e49165e78981144d30bd97f2cc8ed">WiFiUDP::peek</a></div><div class="ttdeci">virtual int peek()</div><div class="ttdoc">Get the next byte from the current packet without moving on to the next byte.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00343">WiFiUdp.cpp:343</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55bac3e8ad93e3a6f831cb31ce15b8e18a7c"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bac3e8ad93e3a6f831cb31ce15b8e18a7c">GET_CURR_RSSI</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00040">CommCmd.h:40</a></div></div>
<div class="ttc" id="events_8h_html_a6f0583ea1b845a7b3c9708e05beb2bac"><div class="ttname"><a href="events_8h.html#a6f0583ea1b845a7b3c9708e05beb2bac">WiFi_STAdisconnectedFromAP</a></div><div class="ttdeci">bool WiFi_STAdisconnectedFromAP() __attribute__((weak))</div><div class="ttdoc">a station disconnected from ESP32 soft-AP</div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55bac299c95ea1c165b31b18784254ebb6e7"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bac299c95ea1c165b31b18784254ebb6e7">AVAIL_DATA_TCP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00056">CommCmd.h:56</a></div></div>
<div class="ttc" id="events_8h_html_a91f7e095a6de63c8d8243659333dd51c"><div class="ttname"><a href="events_8h.html#a91f7e095a6de63c8d8243659333dd51c">WiFi_startedSTA</a></div><div class="ttdeci">bool WiFi_startedSTA() __attribute__((weak))</div><div class="ttdoc">ESP32 station start.</div></div>
<div class="ttc" id="classControl2WiFi_html_a16d5a8f8fd868aebc9606d69f68a5ba0"><div class="ttname"><a href="classControl2WiFi.html#a16d5a8f8fd868aebc9606d69f68a5ba0">Control2WiFi::gatewayIP</a></div><div class="ttdeci">IPAddress gatewayIP()</div><div class="ttdoc">Get the gateway ip address.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l00915">Control2WiFi.cpp:915</a></div></div>
<div class="ttc" id="WiFi2Control_8cpp_html_a515783515458c562d6e4c6fb906264e2"><div class="ttname"><a href="WiFi2Control_8cpp.html#a515783515458c562d6e4c6fb906264e2">wifi2control</a></div><div class="ttdeci">WiFi2ControlClass wifi2control</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8cpp_source.html#l01637">WiFi2Control.cpp:1637</a></div></div>
<div class="ttc" id="classCommunication_html_a53722ef58d275f2870e956526ceae8fe"><div class="ttname"><a href="classCommunication.html#a53722ef58d275f2870e956526ceae8fe">Communication::registerHandle</a></div><div class="ttdeci">bool registerHandle(void(*func)(uint8_t *))</div><div class="ttdoc">Register an handle function to process commands in external libraries.</div><div class="ttdef"><b>Definition:</b> <a href="communication_8cpp_source.html#l00280">communication.cpp:280</a></div></div>
<div class="ttc" id="classWiFiServer_html"><div class="ttname"><a href="classWiFiServer.html">WiFiServer</a></div><div class="ttdef"><b>Definition:</b> <a href="WiFiServer_8h_source.html#l00032">WiFiServer.h:32</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_aff01ffcf31a4e69cb2189ac3226ed91a"><div class="ttname"><a href="classWiFi2ControlClass.html#aff01ffcf31a4e69cb2189ac3226ed91a">WiFi2ControlClass::tempNetworkParam</a></div><div class="ttdeci">tsNetParam tempNetworkParam</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00369">WiFi2Control.h:369</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55bad10173b7f1f5ee3ac8df3d3d6f68ef9f"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55bad10173b7f1f5ee3ac8df3d3d6f68ef9f">SEND_DATA_TCP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00061">CommCmd.h:61</a></div></div>
<div class="ttc" id="classWiFi2ControlClass_html_a23320955ecd80a7ac3d087e033409c44"><div class="ttname"><a href="classWiFi2ControlClass.html#a23320955ecd80a7ac3d087e033409c44">WiFi2ControlClass::networkArray</a></div><div class="ttdeci">tsNetArray networkArray</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00370">WiFi2Control.h:370</a></div></div>
<div class="ttc" id="classCommunication_html_a9365d394a01fb982423e81a927521435"><div class="ttname"><a href="classCommunication.html#a9365d394a01fb982423e81a927521435">Communication::sendCmdPkt</a></div><div class="ttdeci">bool sendCmdPkt(uint8_t cmd, uint8_t numParam)</div><div class="ttdoc">Start sending a command packet to the companion chip with the specified command.</div><div class="ttdef"><b>Definition:</b> <a href="communication_8cpp_source.html#l00356">communication.cpp:356</a></div></div>
<div class="ttc" id="structtsSockStatus_html_aaabca1f6fb1e74552fd62311a0349bb2"><div class="ttname"><a href="structtsSockStatus.html#aaabca1f6fb1e74552fd62311a0349bb2">tsSockStatus::conn</a></div><div class="ttdeci">bool conn</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00079">WiFi2Control.h:79</a></div></div>
<div class="ttc" id="classCommunication_html_a3137df25dd09e15bd7f2efa996f4deb0"><div class="ttname"><a href="classCommunication.html#a3137df25dd09e15bd7f2efa996f4deb0">Communication::appendBuffer</a></div><div class="ttdeci">bool appendBuffer(const uint8_t *data, uint32_t len)</div><div class="ttdoc">Add a buffer to the previously initialized packet.</div><div class="ttdef"><b>Definition:</b> <a href="communication_8cpp_source.html#l00376">communication.cpp:376</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba2c59a3c99c4a672a33aa6b50edebc69c"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2c59a3c99c4a672a33aa6b50edebc69c">SET_DNS_CONFIG</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00030">CommCmd.h:30</a></div></div>
<div class="ttc" id="wl__definitions_8h_html_a8620f1e676d897f95fdbdc12bac59f42a321b58e6917f8ba6733b1e9ebef51e9b"><div class="ttname"><a href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a321b58e6917f8ba6733b1e9ebef51e9b">WL_CONNECTED</a></div><div class="ttdef"><b>Definition:</b> <a href="wl__definitions_8h_source.html#l00057">wl_definitions.h:57</a></div></div>
<div class="ttc" id="events_8h_html_a239236b07de039a3c606310db6d539ee"><div class="ttname"><a href="events_8h.html#a239236b07de039a3c606310db6d539ee">WiFi_stoppedAP</a></div><div class="ttdeci">bool WiFi_stoppedAP() __attribute__((weak))</div><div class="ttdoc">ESP32 soft-AP stop.</div></div>
<div class="ttc" id="events_8h_html_a9c09a4e455e72a2dec2a832c957a01bc"><div class="ttname"><a href="events_8h.html#a9c09a4e455e72a2dec2a832c957a01bc">WiFi_STAconnectedToAP</a></div><div class="ttdeci">bool WiFi_STAconnectedToAP() __attribute__((weak))</div><div class="ttdoc">a station connected to ESP32 soft-AP</div></div>
<div class="ttc" id="classWiFi2ControlClass_html_a7291ed031876956bc6380e46882c4037"><div class="ttname"><a href="classWiFi2ControlClass.html#a7291ed031876956bc6380e46882c4037">WiFi2ControlClass::UI_alert</a></div><div class="ttdeci">bool UI_alert</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00378">WiFi2Control.h:378</a></div></div>
<div class="ttc" id="events_8h_html_a67c1cacbe4dd1e3759784ce8db9c2fae"><div class="ttname"><a href="events_8h.html#a67c1cacbe4dd1e3759784ce8db9c2fae">WiFi_wpsEnrolleeTimeout</a></div><div class="ttdeci">bool WiFi_wpsEnrolleeTimeout() __attribute__((weak))</div><div class="ttdoc">ESP32 station wps timeout in enrollee mode.</div></div>
<div class="ttc" id="classControl2WiFi_html_add60a0aa242df0c996bee49aa432bddd"><div class="ttname"><a href="classControl2WiFi.html#add60a0aa242df0c996bee49aa432bddd">Control2WiFi::subnetMask</a></div><div class="ttdeci">IPAddress subnetMask()</div><div class="ttdoc">Get the interface subnet mask address.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l00879">Control2WiFi.cpp:879</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba2e4494a749e2575ef2cc9dd242ed2831"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2e4494a749e2575ef2cc9dd242ed2831">CONNECT_OPEN_AP</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00026">CommCmd.h:26</a></div></div>
<div class="ttc" id="classWiFiUDP_html_a7132f319951c135ec7648ce1a51f02a9"><div class="ttname"><a href="classWiFiUDP.html#a7132f319951c135ec7648ce1a51f02a9">WiFiUDP::endPacket</a></div><div class="ttdeci">virtual int endPacket()</div><div class="ttdoc">Complete the building of a packet and send it to the remote host.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00170">WiFiUdp.cpp:170</a></div></div>
<div class="ttc" id="events_8h_html_a0fd5c6953941943272e08c32f3cc9a2b"><div class="ttname"><a href="events_8h.html#a0fd5c6953941943272e08c32f3cc9a2b">WiFi_connected</a></div><div class="ttdeci">bool WiFi_connected() __attribute__((weak))</div><div class="ttdoc">ESP32 station connected to AP.</div></div>
<div class="ttc" id="structtsSockStatus_html_ae3aa4acc04c59c0bea282b682be9ab8d"><div class="ttname"><a href="structtsSockStatus.html#ae3aa4acc04c59c0bea282b682be9ab8d">tsSockStatus::protocol</a></div><div class="ttdeci">uint8_t protocol</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00080">WiFi2Control.h:80</a></div></div>
<div class="ttc" id="wl__definitions_8h_html_a8620f1e676d897f95fdbdc12bac59f42a23eb406d022f014ca5cc982dc3d3d681"><div class="ttname"><a href="wl__definitions_8h.html#a8620f1e676d897f95fdbdc12bac59f42a23eb406d022f014ca5cc982dc3d3d681">WL_IDLE_STATUS</a></div><div class="ttdef"><b>Definition:</b> <a href="wl__definitions_8h_source.html#l00054">wl_definitions.h:54</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba70802fb550abcdde74b43342bae89dea"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba70802fb550abcdde74b43342bae89dea">GET_FW_VERSION</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00049">CommCmd.h:49</a></div></div>
<div class="ttc" id="events_8h_html_a0b4b9d9ea9797b24f475eb0dc1829eb4"><div class="ttname"><a href="events_8h.html#a0b4b9d9ea9797b24f475eb0dc1829eb4">WiFi_scanDone</a></div><div class="ttdeci">bool WiFi_scanDone() __attribute__((weak))</div><div class="ttdoc">ESP32 finish scanning AP.</div></div>
<div class="ttc" id="classWiFi2ControlClass_html_a174bb9824460cbe63fb27ddd4e63971b"><div class="ttname"><a href="classWiFi2ControlClass.html#a174bb9824460cbe63fb27ddd4e63971b">WiFi2ControlClass::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">perform the main initializations needed to the class.</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8cpp_source.html#l00188">WiFi2Control.cpp:188</a></div></div>
<div class="ttc" id="events_8h_html_a269ab8c264464ed08cfbdf747294992c"><div class="ttname"><a href="events_8h.html#a269ab8c264464ed08cfbdf747294992c">WiFi_gotIP</a></div><div class="ttdeci">bool WiFi_gotIP() __attribute__((weak))</div><div class="ttdoc">ESP32 station got IP from connected AP.</div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba5539e53ed61fde62295ba4af1b845243"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba5539e53ed61fde62295ba4af1b845243">GET_CONN_STATUS</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00035">CommCmd.h:35</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55baa0621f916125879e94f0932344d8b727"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55baa0621f916125879e94f0932344d8b727">AUTOCONNECT_TO_STA</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00033">CommCmd.h:33</a></div></div>
<div class="ttc" id="events_8h_html_a7fa4ede1f42d0fd1407e4c7a2428ac05"><div class="ttname"><a href="events_8h.html#a7fa4ede1f42d0fd1407e4c7a2428ac05">WiFi_startedAP</a></div><div class="ttdeci">bool WiFi_startedAP() __attribute__((weak))</div><div class="ttdoc">ESP32 soft-AP start.</div></div>
<div class="ttc" id="classWiFi2ControlClass_html_aff215dbd9b5148412da2cc8e67f80579"><div class="ttname"><a href="classWiFi2ControlClass.html#aff215dbd9b5148412da2cc8e67f80579">WiFi2ControlClass::connectionRequested</a></div><div class="ttdeci">bool connectionRequested</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8h_source.html#l00373">WiFi2Control.h:373</a></div></div>
<div class="ttc" id="CommCmd_8h_html_a06fc87d81c62e9abb8790b6e5713c55ba2f6318afb30e8e2817e6203ebedc8173"><div class="ttname"><a href="CommCmd_8h.html#a06fc87d81c62e9abb8790b6e5713c55ba2f6318afb30e8e2817e6203ebedc8173">DISCONNECT</a></div><div class="ttdef"><b>Definition:</b> <a href="CommCmd_8h_source.html#l00043">CommCmd.h:43</a></div></div>
<div class="ttc" id="classCommunication_html_a192d1f46707326743415e3b4dc97fcad"><div class="ttname"><a href="classCommunication.html#a192d1f46707326743415e3b4dc97fcad">Communication::sendParam</a></div><div class="ttdeci">bool sendParam(uint8_t *param, uint8_t param_len, uint8_t lastParam=NO_LAST_PARAM)</div><div class="ttdoc">Add a parameter to the previously initialized packet.</div><div class="ttdef"><b>Definition:</b> <a href="communication_8cpp_source.html#l00364">communication.cpp:364</a></div></div>
<div class="ttc" id="WiFi2Control_8cpp_html_a53627a87689f6b28c893e4f83c15087d"><div class="ttname"><a href="WiFi2Control_8cpp.html#a53627a87689f6b28c893e4f83c15087d">onEvent</a></div><div class="ttdeci">void onEvent(WiFiEvent_t event)</div><div class="ttdef"><b>Definition:</b> <a href="WiFi2Control_8cpp_source.html#l00026">WiFi2Control.cpp:26</a></div></div>
<div class="ttc" id="classControl2WiFi_html_af5b13619e82e5c193c7c51205319e37b"><div class="ttname"><a href="classControl2WiFi.html#af5b13619e82e5c193c7c51205319e37b">Control2WiFi::getHostname</a></div><div class="ttdeci">char * getHostname()</div><div class="ttdoc">Get the hostname associated to the board.</div><div class="ttdef"><b>Definition:</b> <a href="Control2WiFi_8cpp_source.html#l00334">Control2WiFi.cpp:334</a></div></div>
<div class="ttc" id="classWiFiUDP_html_a4020465ab25cf3b88e23e6bb675e0eee"><div class="ttname"><a href="classWiFiUDP.html#a4020465ab25cf3b88e23e6bb675e0eee">WiFiUDP::beginPacket</a></div><div class="ttdeci">virtual int beginPacket(IPAddress ip, uint16_t port)</div><div class="ttdoc">Start building up a packet to send to the remote host.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00133">WiFiUdp.cpp:133</a></div></div>
<div class="ttc" id="classWiFiUDP_html_afbb462d4239b67348c430828b4b43f9b"><div class="ttname"><a href="classWiFiUDP.html#afbb462d4239b67348c430828b4b43f9b">WiFiUDP::remotePort</a></div><div class="ttdeci">virtual uint16_t remotePort()</div><div class="ttdoc">Get the port of the host who sent the current incoming packet.</div><div class="ttdef"><b>Definition:</b> <a href="WiFiUdp_8cpp_source.html#l00434">WiFiUdp.cpp:434</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_f396504afdc959660871b003fa10164d.html">Documents</a></li><li class="navelem"><a class="el" href="dir_1ff56a8542c5da85d9f5c9ecf90c3ea3.html">Arduino</a></li><li class="navelem"><a class="el" href="dir_2acb69ac8df26e9e75c66ce3f541f255.html">hardware</a></li><li class="navelem"><a class="el" href="dir_6aa90f7f71e3cf5d2afdea9f35a5777d.html">Meteca</a></li><li class="navelem"><a class="el" href="dir_3a5806dae95b45d5be62b597677498ea.html">mbc-wb</a></li><li class="navelem"><a class="el" href="dir_7587beba4653cd29a136cf350c74429d.html">libraries</a></li><li class="navelem"><a class="el" href="dir_7faea6a4e129f28792585560ccfba1d4.html">WiFi2Control</a></li><li class="navelem"><a class="el" href="dir_0bcfb2d6c9cdcf7a7d7e0ad8d2f2d2d6.html">src</a></li><li class="navelem"><a class="el" href="WiFi2Control_8cpp.html">WiFi2Control.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
